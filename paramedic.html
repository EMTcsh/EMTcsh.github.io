<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì‘ê¸‰í™˜ì ê¸°ë¡ ì˜ë£Œì§€ë„</title>
<style>
body { font-family: Arial, sans-serif; max-width: 700px; margin: 20px auto; padding: 20px; background: #f7f7f7; border-radius: 8px; }
h1, h2 { color: #333; }
label { display: block; margin-top: 15px; font-weight: bold; }
input[type="text"], input[type="number"], input[type="time"], textarea { width: 100%; padding: 8px; margin-top: 6px; border-radius: 4px; border: 1px solid #ccc; font-size: 1rem; box-sizing: border-box; }
textarea { resize: vertical; min-height: 80px; }
button { margin-top: 10px; padding: 10px 20px; border: none; color: white; border-radius: 5px; cursor: pointer; font-size: 1rem; }
button.save { background-color: #28a745; }
button.save:hover { background-color: #1e7e34; }
button.submit { background-color: #007bff; }
button.submit:hover { background-color: #0056b3; }
.record-output, .summary-output { margin-top: 20px; padding: 15px; background: #e9ecef; border-radius: 5px; white-space: pre-wrap; font-family: monospace; }
.buttons-group { margin-top: 10px; }
.buttons-group button { margin-right: 10px; background-color: #17a2b8; }
.buttons-group button:hover { background-color: #117a8b; }
</style>
</head>
<body>

<h1>ì‘ê¸‰í™˜ì ê¸°ë¡ ì˜ë£Œì§€ë„</h1>

<form id="recordForm">
    <label for="recordTime">ê¸°ë¡ ì‹œê°„</label>
    <input type="time" id="recordTime" name="recordTime" required />

    <h2>MIST ë³´ê³ </h2>
    <label for="mechanism">Mechanism (ê¸°ì „)</label>
    <textarea id="mechanism" name="mechanism" required></textarea>
    <label for="injury">Injury (ì†ìƒë¶€ìœ„)</label>
    <textarea id="injury" name="injury" required></textarea>
    <label for="signs">Signs (ì¦ìƒ)</label>
    <textarea id="signs" name="signs" required></textarea>
    <label for="treatment">Treatment (ì²˜ì¹˜ ë‚´ìš©)</label>
    <textarea id="treatment" name="treatment" required></textarea>
    <button type="button" class="save" id="saveMist">ğŸ’¾ MIST ì €ì¥</button>

    <h2>SBAR ë³´ê³ </h2>
    <label for="situation">Situation</label>
    <textarea id="situation" name="situation" required></textarea>
    <label for="background">Background</label>
    <textarea id="background" name="background" required></textarea>
    <label for="assessment">Assessment</label>
    <textarea id="assessment" name="assessment" required></textarea>
    <label for="recommendation">Recommendation</label>
    <textarea id="recommendation" name="recommendation" required></textarea>
    <button type="button" class="save" id="saveSbar">ğŸ’¾ SBAR ì €ì¥</button>

    <h2>í™œë ¥ì§•í›„ ê¸°ë¡</h2>
    <label for="bp">í˜ˆì•• (mmHg)</label>
    <input type="text" id="bp" name="bp" required />
    <label for="hr">ì‹¬ë°•ìˆ˜ (íšŒ/ë¶„)</label>
    <input type="number" id="hr" name="hr" min="30" max="200" required />
    <label for="rr">í˜¸í¡ìˆ˜ (íšŒ/ë¶„)</label>
    <input type="number" id="rr" name="rr" min="5" max="50" required />
    <label for="temp">ì²´ì˜¨ (â„ƒ)</label>
    <input type="number" step="0.1" id="temp" name="temp" min="30" max="45" required />
    <button type="button" class="save" id="saveVitals">ğŸ’¾ í™œë ¥ì§•í›„ ì €ì¥</button>

    <h2>ì˜ë£Œ ì§€ë„</h2>
    <label for="medicalInstruction">ì˜ë£Œ ì§€ë„ ë‚´ìš©</label>
    <textarea id="medicalInstruction" name="medicalInstruction" required></textarea>

    <button type="submit" class="submit">ğŸ’¾ ì „ì²´ ê¸°ë¡ ì €ì¥ ë° ìš”ì•½ ìƒì„±</button>
</form>

<div id="output" class="record-output" style="display:none;"></div>
<h2>ì˜ë£Œì§€ë„ ìš”ì²­ ìš”ì•½</h2>
<div id="summary" class="summary-output" style="display:none;"></div>
<div class="buttons-group" id="summaryButtons" style="display:none;">
    <button id="copySummary">ë³µì‚¬</button>
    <button id="savePdf">PDF ì €ì¥</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw_w8mJQtg4LAmPkDCIjWjyQKwMPcaRJsF1DaBG_cTFMrN7m0h1I3wpZILrDOZx7qvKXg/exec"; // Apps Script ì›¹ì•± URL

const form = document.getElementById('recordForm');
const outputDiv = document.getElementById('output');
const summaryDiv = document.getElementById('summary');
const summaryButtons = document.getElementById('summaryButtons');
const copyBtn = document.getElementById('copySummary');
const savePdfBtn = document.getElementById('savePdf');

function saveSection(section, data) {
    fetch(SCRIPT_URL, {
        method: 'POST',
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(data)
    })
    .then(res=>res.json())
    .then(res=>{
        if(res.status==='success') alert(`${section} ì €ì¥ ì™„ë£Œ!`);
        else alert(`${section} ì €ì¥ ì‹¤íŒ¨: ${res.message}`);
    })
    .catch(err=>{ console.error(err); alert(`${section} ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ`); });
}

// MIST ì €ì¥
document.getElementById('saveMist').addEventListener('click', ()=>{
    const data = {
        recordTime: form.recordTime.value,
        MIST: {
            mechanism: form.mechanism.value.trim(),
            injury: form.injury.value.trim(),
            signs: form.signs.value.trim(),
            treatment: form.treatment.value.trim()
        }
    };
    saveSection('MIST', data);
});

// SBAR ì €ì¥
document.getElementById('saveSbar').addEventListener('click', ()=>{
    const data = {
        recordTime: form.recordTime.value,
        SBAR: {
            situation: form.situation.value.trim(),
            background: form.background.value.trim(),
            assessment: form.assessment.value.trim(),
            recommendation: form.recommendation.value.trim()
        }
    };
    saveSection('SBAR', data);
});

// í™œë ¥ì§•í›„ ì €ì¥
document.getElementById('saveVitals').addEventListener('click', ()=>{
    const data = {
        recordTime: form.recordTime.value,
        vitals: {
            bp: form.bp.value.trim(),
            hr: form.hr.value.trim(),
            rr: form.rr.value.trim(),
            temp: form.temp.value.trim()
        }
    };
    saveSection('í™œë ¥ì§•í›„', data);
});

// ì „ì²´ ê¸°ë¡ ì œì¶œ
form.addEventListener('submit', (e)=>{
    e.preventDefault();
    const data = {
        recordTime: form.recordTime.value,
        MIST: {
            mechanism: form.mechanism.value.trim(),
            injury: form.injury.value.trim(),
            signs: form.signs.value.trim(),
            treatment: form.treatment.value.trim()
        },
        SBAR: {
            situation: form.situation.value.trim(),
            background: form.background.value.trim(),
            assessment: form.assessment.value.trim(),
            recommendation: form.recommendation.value.trim()
        },
        vitals: {
            bp: form.bp.value.trim(),
            hr: form.hr.value.trim(),
            rr: form.rr.value.trim(),
            temp: form.temp.value.trim()
        },
        medicalInstruction: form.medicalInstruction.value.trim()
    };

    // ì „ì²´ ê¸°ë¡ ì¶œë ¥
    outputDiv.textContent = JSON.stringify(data, null, 2);
    outputDiv.style.display='block';

    saveSection('ì „ì²´ ê¸°ë¡', data);

    // ìš”ì•½ ìƒì„±
    let summaryText = data.medicalInstruction;
    if(summaryText.length>100) summaryText = summaryText.slice(0,97)+'...';
    summaryDiv.textContent = summaryText;
    summaryDiv.style.display='block';
    summaryButtons.style.display='block';
});

// ìš”ì•½ ë³µì‚¬
copyBtn.addEventListener('click', ()=>{ navigator.clipboard.writeText(summaryDiv.textContent).then(()=>alert('ë³µì‚¬ ì™„ë£Œ')); });

// ìš”ì•½ PDF
savePdfBtn.addEventListener('click', ()=>{
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.setFontSize(16);
    doc.text("ì˜ë£Œì§€ë„ ìš”ì²­ ìš”ì•½", 10, 20);
    doc.setFontSize(12);
    const splitText = doc.splitTextToSize(summaryDiv.textContent, 180);
    doc.text(splitText, 10, 30);
    doc.save('ì˜ë£Œì§€ë„_ìš”ì²­_ìš”ì•½.pdf');
});
</script>

</body>
</html>
