<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ğŸï¸ êµ­ë¦½ê³µì› ì‚°í–‰ QR ì²´í¬</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial;background:#f4f6f8;padding:20px}
.container{max-width:500px;margin:auto;background:#fff;padding:20px;border-radius:10px}
button{width:100%;padding:15px;font-size:16px;margin-top:10px;border:none;border-radius:6px;color:#fff}
.entry{background:#4caf50}
.mid{background:#2196f3}
.exit{background:#f44336}
input{width:100%;padding:12px;font-size:15px;margin-bottom:10px}
</style>
</head>
<body>
<div class="container">
<h2>ğŸï¸ êµ­ë¦½ê³µì› ì‚°í–‰ ì²´í¬</h2>
<input type="tel" id="phone" placeholder="íœ´ëŒ€í° ë²ˆí˜¸ (ìµœì´ˆ 1íšŒ ì…ë ¥)">
<button class="entry" onclick="scan('ì…ì¥')">ì…êµ¬ ìŠ¤ìº”</button>
<button class="mid" onclick="scan('ì¤‘ê°„')">ì¤‘ê°„ ìŠ¤ìº”</button>
<button class="exit" onclick="scan('í‡´ì¥')">ì¶œêµ¬ ìŠ¤ìº”</button>
<p id="status"></p>
</div>
<script>
const SHEET_URL = "https://script.google.com/macros/s/AKfycbyu-WKRdnTCWpgTFvzC8-FFD1U93z5PabjyRp4ETXvYpjI1RLb79BPbYNy6fsENKDcn/exec";
if(localStorage.phone){document.getElementById('phone').value=localStorage.phone;}
function scan(stage){
const phone=document.getElementById('phone').value.trim();
if(!phone){alert('íœ´ëŒ€í° ë²ˆí˜¸ ì…ë ¥');return;}
localStorage.phone=phone;
if(!navigator.geolocation){alert('GPS ë¯¸ì§€ì›');return;}
navigator.geolocation.getCurrentPosition(pos=>{
fetch(SHEET_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({
stage:stage,
phone:phone,
lat:pos.coords.latitude,
lng:pos.coords.longitude,
time:new Date().toLocaleString()
})}).then(()=>{
document.getElementById('status').innerText=stage+' ì €ì¥ ì™„ë£Œ';
});
},()=>alert('ìœ„ì¹˜ ê¶Œí•œ í•„ìš”'));
}
</script>
</body>
</html>
<!-- ================= GOOGLE APPS SCRIPT =================
function doPost(e) {
const d = JSON.parse(e.postData.contents);
const ss = SpreadsheetApp.openById('ìŠ¤í”„ë ˆë“œì‹œíŠ¸ID');
const sheet = ss.getSheetByName(d.stage) || ss.insertSheet(d.stage);
sheet.appendRow([
new Date(),
d.stage,
d.phone,
d.lat,
d.lng,
d.time
]);
updateFinalSheet();
return ContentService.createTextOutput('OK');
}


function updateFinalSheet(){
const ss=SpreadsheetApp.openById('ìŠ¤í”„ë ˆë“œì‹œíŠ¸ID');
const entry=getPhones(ss,'ì…ì¥');
const mid=getPhones(ss,'ì¤‘ê°„');
const exit=getPhones(ss,'í‡´ì¥');
const sheet=ss.getSheetByName('ë¯¸ì™„ë£Œ_íƒë°©ê°')||ss.insertSheet('ë¯¸ì™„ë£Œ_íƒë°©ê°');
sheet.clear();
sheet.appendRow(['ì „í™”ë²ˆí˜¸','ì…ì¥','ì¤‘ê°„','í‡´ì¥','ìƒíƒœ']);
const all=new Set([...entry,...mid,...exit]);
all.forEach(p=>{
const e=entry.has(p), m=mid.has(p), x=exit.has(p);
if(e&&!x){sheet.appendRow([p,e?'O':'X',m?'O':'X',x?'O':'X',m?'í‡´ì¥ ë¯¸í™•ì¸':'ì¤‘ê°„Â·í‡´ì¥ ë¯¸í™•ì¸']);}
});
}
function getPhones(ss,name){
const sh=ss.getSheetByName(name);
if(!sh) return new Set();
const v=sh.getDataRange().getValues();
const s=new Set();
for(let i=1;i<v.length;i++){s.add(v[i][2]);}
return s;
}
======================================================= -->
