<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ğŸ†˜ í˜„ì¥ ì¢Œí‘œ ë³€í™˜ê¸°</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=ff9e145029506d6e4c72d1f2b01ea424"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.9.0/proj4.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mgrs/1.0.0/mgrs.min.js"></script>

<style>
*{box-sizing:border-box}
body{margin:0;padding-bottom:120px;font-family:system-ui;background:#0f172a;color:#fff}
.header{padding:14px;text-align:center;font-size:18px;font-weight:700;background:#020617}
.card{background:#020617;border-radius:16px;padding:14px;margin:12px}
pre{white-space:pre-wrap;line-height:1.6;font-size:15px;background:#020617;border:1px solid #1e293b;border-radius:14px;padding:14px}
#map{height:260px;margin:12px;border-radius:16px}
.action-bar{position:fixed;bottom:0;left:0;right:0;background:#020617;display:flex;gap:8px;padding:10px}
.action-bar button{flex:1;padding:16px;font-size:16px;font-weight:700;border:none;border-radius:16px}
.primary{background:linear-gradient(135deg,#22c55e,#16a34a);color:#020617}
.secondary{background:#334155;color:#fff}
</style>
</head>

<body>

<div class="header">ğŸ†˜ í˜„ìœ„ì¹˜ ì¢Œí‘œ (DMS / MGRS)</div>

<div class="card">
  <pre id="result">ğŸ“¡ í˜„ì¬ìœ„ì¹˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”</pre>
</div>

<div id="map"></div>

<div class="action-bar">
  <button class="primary" onclick="goCurrent()">ğŸ“¡ í˜„ì¬ìœ„ì¹˜</button>
  <button class="secondary" onclick="shareAll()">ğŸ“¤ ê³µìœ </button>
</div>

<script>
/* TM-K */
proj4.defs("EPSG:5179",
"+proj=tmerc +lat_0=38 +lon_0=127.5 +k=0.9996 +x_0=1000000 +y_0=2000000 +ellps=GRS80 +units=m +no_defs");

/* ìœ í‹¸ */
function toDMS(d){
  const D=Math.floor(d);
  const M=Math.floor((d-D)*60);
  const S=(((d-D)*60-M)*60).toFixed(2);
  return `${D}Â° ${M}â€² ${S}â€³`;
}
function national(x,y){
  return `${Math.floor(x/100)} ${Math.floor(y/100)}`;
}

/* ì§€ë„ */
let map,marker;
function initMap(lat=35.131486,lon=126.947881){
  const pos=new kakao.maps.LatLng(lat,lon);
  map=new kakao.maps.Map(document.getElementById("map"),{center:pos,level:3});
  marker=new kakao.maps.Marker({position:pos});
  marker.setMap(map);
}
function moveMap(lat,lon){
  if(!map||!marker)return;
  const pos=new kakao.maps.LatLng(lat,lon);
  marker.setPosition(pos);
  map.setCenter(pos);
}

/* í˜„ì¬ ìœ„ì¹˜ */
function goCurrent(){
  if(!navigator.geolocation){
    alert("ìœ„ì¹˜ ì‚¬ìš© ë¶ˆê°€");
    return;
  }

  navigator.geolocation.getCurrentPosition(p=>{
    const lat=p.coords.latitude;
    const lon=p.coords.longitude;

    const tm=proj4("WGS84","EPSG:5179",[lon,lat]);
    const mgrsCode=mgrs.forward([lon,lat],5);

    result.textContent =
`ğŸ“ í˜„ì¬ ìœ„ì¹˜ ì¢Œí‘œ

ğŸ“Œ ë„ì¢Œí‘œ (DD)
${lat.toFixed(6)}, ${lon.toFixed(6)}

ğŸ“ ë„ë¶„ì´ˆ (DMS)
${toDMS(lat)} / ${toDMS(lon)}

ğŸ– êµ°ì‚¬ì¢Œí‘œ (MGRS)
${mgrsCode}

ğŸ§­ TM / UTM-K
E ${Math.floor(tm[0])}
N ${Math.floor(tm[1])}

ğŸ” êµ­ê°€ì§€ì ë²ˆí˜¸
${national(tm[0],tm[1])}
`;

    moveMap(lat,lon);
  },
  ()=>alert("ìœ„ì¹˜ ê¶Œí•œ í•„ìš”"),
  {enableHighAccuracy:true,timeout:8000});
}

/* ê³µìœ  */
function shareAll(){
  const t=result.textContent;
  if(!t)return;
  const m=t.match(/([0-9.\-]+),\s([0-9.\-]+)/);
  if(!m)return;
  const link=`https://map.kakao.com/link/map/${m[1]},${m[2]}`;
  const msg=`ğŸ†˜ í˜„ì¬ ìœ„ì¹˜ ì¢Œí‘œ\n\n${t}\n\nğŸ“ ì§€ë„\n${link}`;

  if(navigator.share){
    navigator.share({title:"í˜„ì¬ ìœ„ì¹˜",text:msg});
  }else{
    window.open("https://sharer.kakao.com/talk/friends/picker/link?text="+encodeURIComponent(msg));
  }
}

initMap();
</script>

</body>
</html>
