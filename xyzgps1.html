<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ğŸ†˜ í˜„ì¥ ì¢Œí‘œ ë³€í™˜ê¸°</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Kakao Map -->
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=ff9e145029506d6e4c72d1f2b01ea424"></script>

<!-- proj4 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.9.0/proj4.js"></script>

<!-- MGRS -->
<script src="https://cdn.jsdelivr.net/npm/mgrs@1.0.0/dist/mgrs.min.js"></script>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  padding-bottom:120px;
  font-family:system-ui,Arial;
  background:#0f172a;
  color:#fff;
}
.header{
  padding:14px;
  text-align:center;
  font-size:18px;
  font-weight:700;
  background:#020617;
}
.card{
  background:#020617;
  border-radius:16px;
  padding:14px;
  margin:12px;
}
select,input{
  width:100%;
  min-height:56px;
  padding:18px;
  margin-top:10px;
  font-size:18px;
  border-radius:14px;
  border:none;
  background:#1e293b;
  color:#fff;
}
pre{
  white-space:pre-wrap;
  line-height:1.6;
  font-size:15px;
  background:#020617;
  border:1px solid #1e293b;
  border-radius:14px;
  padding:14px;
}
#map{
  height:260px;
  margin:12px;
  border-radius:16px;
  overflow:hidden;
  position:relative;
}
#coordOverlay{
  position:absolute;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(2,6,23,.85);
  padding:10px 14px;
  border-radius:12px;
  font-size:14px;
  border:1px solid #1e293b;
  z-index:10;
  text-align:center;
}
.action-bar{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  background:#020617;
  display:flex;
  gap:10px;
  padding:10px;
}
.action-bar button{
  flex:1;
  padding:18px;
  font-size:15px;
  font-weight:700;
  border:none;
  border-radius:16px;
}
.primary{background:linear-gradient(135deg,#22c55e,#16a34a);color:#020617}
.share{background:#0ea5e9;color:#020617}
.copy{background:#facc15;color:#020617}
</style>
</head>

<body>

<div class="header">ğŸ†˜ í˜„ì¥ ì¢Œí‘œ ë³€í™˜ê¸°</div>

<div class="card">
  <select id="mode">
    <option value="dd">ë„ì¢Œí‘œ (DD)</option>
    <option value="dms">ë„ë¶„ì´ˆ (DMS)</option>
    <option value="mgrs">êµ°ì‚¬ì¢Œí‘œ (MGRS)</option>
  </select>

  <input id="lat" placeholder="ìœ„ë„ (35.131486 / 35 7 53.35)">
  <input id="lon" placeholder="ê²½ë„ (126.947881 / 126 56 52.37)">
</div>

<div class="card" id="mgrsBox" style="display:none">
  <input id="mgrs" placeholder="êµ°ì‚¬ì¢Œí‘œ (ì˜ˆ: 52SDG 96000 19400)">
</div>

<div class="card">
  <input id="np" placeholder="êµ­ê°€ì§€ì ë²ˆí˜¸ (ì˜ˆ: 960 1940)">
</div>

<div class="card">
  <pre id="result">ì¢Œí‘œ ì…ë ¥ í›„ [ë³€í™˜]ì„ ëˆ„ë¥´ì„¸ìš”</pre>
</div>

<div id="map">
  <div id="coordOverlay">ğŸ“ ìœ„ì¹˜ ëŒ€ê¸°ì¤‘</div>
</div>

<div class="action-bar">
  <button class="primary" onclick="convert()">ğŸ“ ë³€í™˜</button>
  <button class="copy" onclick="copyCoords()">ğŸ“‹ ë³µì‚¬</button>
  <button class="share" onclick="shareAll()">ğŸ“¤ ê³µìœ </button>
</div>

<script>
/* EPSG */
proj4.defs("EPSG:5179",
"+proj=tmerc +lat_0=38 +lon_0=127.5 +k=0.9996 +x_0=1000000 +y_0=2000000 +ellps=GRS80 +units=m +no_defs");

/* DOM */
const latInput = document.getElementById("lat");
const lonInput = document.getElementById("lon");
const np = document.getElementById("np");
const mode = document.getElementById("mode");
const result = document.getElementById("result");
const mgrsInput = document.getElementById("mgrs");

/* ìœ í‹¸ */
function dmsToDD(v){
  const p=v.trim().split(/\s+/).map(Number);
  return p[0]+p[1]/60+p[2]/3600;
}
function toDMS(d){
  const D=Math.floor(d);
  const M=Math.floor((d-D)*60);
  const S=(((d-D)*60-M)*60).toFixed(2);
  return `${D}Â° ${M}â€² ${S}â€³`;
}
function national(x,y){
  return `${Math.floor(x/100)} ${Math.floor(y/100)}`;
}
function calcDistance(lat1, lon1, lat2, lon2){
  const R=6371000;
  const r=d=>d*Math.PI/180;
  const dLat=r(lat2-lat1);
  const dLon=r(lon2-lon1);
  const a=Math.sin(dLat/2)**2+
          Math.cos(r(lat1))*Math.cos(r(lat2))*
          Math.sin(dLon/2)**2;
  return Math.round(R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)));
}

/* ì§€ë„ */
let map, marker, myMarker, myLat, myLon;

function initMap(){
  const center=new kakao.maps.LatLng(35.131486,126.947881);
  map=new kakao.maps.Map(document.getElementById("map"),{center,level:4});

  marker=new kakao.maps.Marker();
  marker.setMap(map);

  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(pos=>{
      myLat=pos.coords.latitude;
      myLon=pos.coords.longitude;
      const myPos=new kakao.maps.LatLng(myLat,myLon);
      myMarker=new kakao.maps.Marker({position:myPos});
      myMarker.setMap(map);
      map.setCenter(myPos);
      updateOverlay(myLat,myLon);
    });
  }
}

function updateOverlay(lat,lon){
  document.getElementById("coordOverlay").innerHTML=
    `ğŸ“ í˜„ì¬ ì¢Œí‘œ<br>ìœ„ë„ ${lat.toFixed(6)}<br>ê²½ë„ ${lon.toFixed(6)}`;
}

/* MGRS */
function mgrsToLatLon(v){
  try{
    const c=mgrs.toPoint(v.replace(/\s+/g,""));
    return {lat:c[1],lon:c[0]};
  }catch(e){
    return null;
  }
}

/* ì…ë ¥ ëª¨ë“œ */
mode.addEventListener("change",()=>{
  document.getElementById("mgrsBox").style.display =
    mode.value==="mgrs" ? "block" : "none";
});

/* ë³€í™˜ */
function convert(){
  let lat,lon;

  if(mode.value==="mgrs"){
    const r=mgrsToLatLon(mgrsInput.value);
    if(!r) return alert("êµ°ì‚¬ì¢Œí‘œ ì˜¤ë¥˜");
    lat=r.lat; lon=r.lon;
  }
  else if(np.value){
    const p=np.value.trim().split(/\s+/).map(Number);
    if(p.length!==2) return alert("êµ­ê°€ì§€ì ë²ˆí˜¸ ì˜¤ë¥˜");
    const wgs=proj4("EPSG:5179","WGS84",[p[0]*100,p[1]*100]);
    lon=wgs[0]; lat=wgs[1];
  }
  else{
    if(mode.value==="dd"){
      lat=parseFloat(latInput.value);
      lon=parseFloat(lonInput.value);
    }else{
      lat=dmsToDD(latInput.value);
      lon=dmsToDD(lonInput.value);
    }
  }

  if(isNaN(lat)||isNaN(lon)) return alert("ì¢Œí‘œ ì˜¤ë¥˜");

  const utm=proj4("WGS84","EPSG:5179",[lon,lat]);
  const x=Math.floor(utm[0]);
  const y=Math.floor(utm[1]);

  let dist="";
  if(myLat&&myLon){
    dist=`\nğŸ“ ë‚´ ìœ„ì¹˜ê¹Œì§€ ê±°ë¦¬: ${calcDistance(myLat,myLon,lat,lon)} m`;
  }

  result.textContent=
`ğŸ†˜ ì¢Œí‘œ ìœ„ì¹˜

WGS84
ìœ„ë„: ${lat.toFixed(6)}
ê²½ë„: ${lon.toFixed(6)}

ë„ë¶„ì´ˆ
${toDMS(lat)} / ${toDMS(lon)}

UTM-K
E ${x}  N ${y}

êµ­ê°€ì§€ì ë²ˆí˜¸
${national(x,y)}${dist}`;

  const pos=new kakao.maps.LatLng(lat,lon);
  marker.setPosition(pos);
  map.setCenter(pos);
  updateOverlay(lat,lon);
}

/* ë³µì‚¬ */
function copyCoords(){
  navigator.clipboard.writeText(result.textContent)
    .then(()=>alert("ğŸ“‹ ì¢Œí‘œ ë³µì‚¬ ì™„ë£Œ"));
}

/* ê³µìœ  */
function shareAll(){
  const m=result.textContent.match(/ìœ„ë„:\s([0-9.\-]+)[\s\S]*?ê²½ë„:\s([0-9.\-]+)/);
  if(!m) return;
  const msg=`ğŸ†˜ ìœ„ì¹˜ ê³µìœ \n\n${result.textContent}\nğŸ“ https://map.kakao.com/link/map/${m[1]},${m[2]}`;
  navigator.share?navigator.share({text:msg}):alert(msg);
}

initMap();
</script>

</body>
</html>
