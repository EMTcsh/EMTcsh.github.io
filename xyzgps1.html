<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ğŸ†˜ í˜„ì¥ ì¢Œí‘œ ë³€í™˜ê¸° (DD / DMS / MGRS / TM / UTM-K)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Kakao Map -->
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=ff9e145029506d6e4c72d1f2b01ea424"></script>

<!-- proj4 + mgrs -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.9.0/proj4.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mgrs/1.0.0/mgrs.min.js"></script>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  padding-bottom:110px;
  font-family:system-ui,Arial;
  background:#0f172a;
  color:#fff;
}
.header{
  padding:14px;
  text-align:center;
  font-size:18px;
  font-weight:700;
  background:#020617;
}
.card{
  background:#020617;
  border-radius:16px;
  padding:14px;
  margin:12px;
}
select,input{
  width:100%;
  min-height:56px;
  padding:18px;
  margin-top:10px;
  font-size:18px;
  border-radius:14px;
  border:none;
  background:#1e293b;
  color:#fff;
}
pre{
  white-space:pre-wrap;
  line-height:1.6;
  font-size:15px;
  background:#020617;
  border:1px solid #1e293b;
  border-radius:14px;
  padding:14px;
}
#map{
  height:240px;
  margin:12px;
  border-radius:16px;
  overflow:hidden;
}
.action-bar{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  background:#020617;
  display:flex;
  gap:10px;
  padding:10px;
}
.action-bar button{
  flex:1;
  padding:18px;
  font-size:17px;
  font-weight:700;
  border:none;
  border-radius:16px;
}
.primary{background:linear-gradient(135deg,#22c55e,#16a34a);color:#020617}
.secondary{background:#334155;color:#fff}
.hide{display:none}
</style>
</head>

<body>

<div class="header">ğŸ†˜ í˜„ì¥ ì¢Œí‘œ ë³€í™˜ê¸° (DD / DMS / MGRS / TM)</div>

<div class="card">
  <select id="mode" onchange="updateInputs()">
    <option value="dd">ë„ì¢Œí‘œ (DD)</option>
    <option value="dms">ë„ë¶„ì´ˆ (DMS)</option>
    <option value="mgrs">êµ°ì‚¬ì¢Œí‘œ (MGRS)</option>
    <option value="tm">TM / UTM-K</option>
  </select>

  <input id="lat" placeholder="ìœ„ë„ (35.131486)">
  <input id="lon" placeholder="ê²½ë„ (126.947881)">

  <input id="mgrsInput" class="hide" placeholder="êµ°ì‚¬ì¢Œí‘œ (52SDG1234567890)">

  <input id="tmX" class="hide" placeholder="TM / UTM-K X (Easting)">
  <input id="tmY" class="hide" placeholder="TM / UTM-K Y (Northing)">
</div>

<div class="card">
  <pre id="result">ì¢Œí‘œ ì…ë ¥ ë˜ëŠ” ì§€ë„ í´ë¦­</pre>
</div>

<div id="map"></div>

<div class="action-bar">
  <button class="primary" onclick="convert()">ğŸ“ ë³€í™˜</button>
  <button class="secondary" onclick="sendKakao()">ğŸ“¨ ì¹´ì¹´ì˜¤í†¡</button>
  <button class="secondary" onclick="sendSMS()">ğŸ“© SMS</button>
</div>

<script>
/* EPSG:5179 (UTM-K / TM-K) */
proj4.defs("EPSG:5179",
"+proj=tmerc +lat_0=38 +lon_0=127.5 +k=0.9996 +x_0=1000000 +y_0=2000000 +ellps=GRS80 +units=m +no_defs");

/* DOM */
const mode = document.getElementById("mode");
const latInput = document.getElementById("lat");
const lonInput = document.getElementById("lon");
const mgrsInput = document.getElementById("mgrsInput");
const tmX = document.getElementById("tmX");
const tmY = document.getElementById("tmY");
const result = document.getElementById("result");

/* ì…ë ¥ ì „í™˜ */
function updateInputs(){
  latInput.classList.add("hide");
  lonInput.classList.add("hide");
  mgrsInput.classList.add("hide");
  tmX.classList.add("hide");
  tmY.classList.add("hide");

  if(mode.value==="dd" || mode.value==="dms"){
    latInput.classList.remove("hide");
    lonInput.classList.remove("hide");
  }
  if(mode.value==="mgrs") mgrsInput.classList.remove("hide");
  if(mode.value==="tm"){
    tmX.classList.remove("hide");
    tmY.classList.remove("hide");
  }
}

/* ìœ í‹¸ */
function dmsToDD(v){
  const p=v.trim().split(/\s+/).map(Number);
  return p[0]+p[1]/60+p[2]/3600;
}
function toDMS(d){
  const D=Math.floor(d);
  const M=Math.floor((d-D)*60);
  const S=(((d-D)*60-M)*60).toFixed(2);
  return `${D}Â° ${M}â€² ${S}â€³`;
}
function national(x,y){
  return `${Math.floor(x/100)} ${Math.floor(y/100)}`;
}

/* ì§€ë„ */
let map,marker;
function initMap(lat=35.131486,lon=126.947881){
  const pos=new kakao.maps.LatLng(lat,lon);
  map=new kakao.maps.Map(document.getElementById("map"),{center:pos,level:3});
  marker=new kakao.maps.Marker({position:pos});
  marker.setMap(map);

  kakao.maps.event.addListener(map,'click',e=>{
    latInput.value=e.latLng.getLat().toFixed(6);
    lonInput.value=e.latLng.getLng().toFixed(6);
    mode.value="dd";
    updateInputs();
    convert();
  });
}
function moveMap(lat,lon){
  if(!map || !marker) return;
  const pos=new kakao.maps.LatLng(lat,lon);
  marker.setPosition(pos);
  map.setCenter(pos);
}

/* ë³€í™˜ */
function convert(){
  let lat, lon;

  try{
    if(mode.value==="dd"){
      lat=parseFloat(latInput.value);
      lon=parseFloat(lonInput.value);
    }
    else if(mode.value==="dms"){
      lat=dmsToDD(latInput.value);
      lon=dmsToDD(lonInput.value);
    }
    else if(mode.value==="mgrs"){
      const p=mgrs.toPoint(mgrsInput.value.trim());
      lon=p[0]; lat=p[1];
    }
    else if(mode.value==="tm"){
      const p=proj4("EPSG:5179","WGS84",[
        parseFloat(tmX.value),
        parseFloat(tmY.value)
      ]);
      lon=p[0]; lat=p[1];
    }
  }catch{
    alert("ì¢Œí‘œ í˜•ì‹ ì˜¤ë¥˜");
    return;
  }

  if(isNaN(lat)||isNaN(lon)){
    alert("ì¢Œí‘œ ì˜¤ë¥˜");
    return;
  }

  const tm=proj4("WGS84","EPSG:5179",[lon,lat]);
  const mgrsCode=mgrs.forward([lon,lat],5);

  result.textContent=
`ğŸ“Œ WGS84
DD : ${lat.toFixed(6)}, ${lon.toFixed(6)}
DMS: ${toDMS(lat)} / ${toDMS(lon)}

ğŸ§­ TM / UTM-K
E ${Math.floor(tm[0])}
N ${Math.floor(tm[1])}

ğŸ” êµ­ê°€ì§€ì ë²ˆí˜¸
${national(tm[0],tm[1])}

ğŸ– êµ°ì‚¬ì¢Œí‘œ (MGRS)
${mgrsCode}
`;

  moveMap(lat,lon);
}

/* ì „ì†¡ */
function message(){
  const m=result.textContent.match(/DD\s:\s([0-9.\-]+),\s([0-9.\-]+)/);
  if(!m) return null;
  return `ğŸ“ êµ¬ì¡° ìœ„ì¹˜\nìœ„ë„:${m[1]}\nê²½ë„:${m[2]}\nhttps://map.kakao.com/link/map/${m[1]},${m[2]}`;
}
function sendKakao(){
  const msg=message(); if(!msg) return;
  window.open("https://sharer.kakao.com/talk/friends/picker/link?text="+encodeURIComponent(msg));
}
function sendSMS(){
  const msg=message(); if(!msg) return;
  location.href=`sms:?body=${encodeURIComponent(msg)}`;
}

updateInputs();
initMap();
</script>

</body>
</html>
