<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>무등산국립공원 안전산행 Check IN/OUT</title>

<style>
body { font-family: Arial, sans-serif; max-width:480px; margin:auto; text-align:center; padding:20px; }
input, button { width:100%; padding:12px; margin:6px 0; font-size:16px; border-radius:8px; }
button.start { background:#007BFF; color:#fff; }
button.mid   { background:#FFC107; }
button.end   { background:#28A745; color:#fff; }
#message { font-size:18px; margin-top:10px; font-weight:bold; }
</style>
</head>
<body>

<h2>무등산국립공원 안전산행</h2>

<input id="phone" placeholder="전화번호 입력">

<button class="start" onclick="send('start')">입구 체크인</button>
<button class="mid" onclick="send('mid')">산행 중</button>
<button class="end" onclick="send('end')">출구 체크아웃</button>

<div id="message"></div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwWDFctYxqQlETrA3SDVeM9wYGWb0WDX7nfHnJKaQdwZT_pk8p_kLN8sAVN3uUhwDyq/exec";
let startTime;

function send(type) {
  const phone = document.getElementById('phone').value;
  if (!phone) return alert("전화번호 입력");

  navigator.geolocation.getCurrentPosition(pos => {
    const now = new Date();
    if (type === 'start') startTime = now;

    const data = {
      phone,
      type,
      lat: pos.coords.latitude,
      lng: pos.coords.longitude,
      timestamp: now.toISOString(),
      mapLink: `https://map.kakao.com/link/map/${pos.coords.latitude},${pos.coords.longitude}`,
      duration: type === 'end' && startTime
        ? ((now - startTime)/60000).toFixed(1) + "분"
        : ""
    };

    fetch(SCRIPT_URL, {
      method: "POST",
      mode: "no-cors",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });

    document.getElementById('message').textContent = "전송 완료";
    setTimeout(()=>document.getElementById('message').textContent="",2000);
  });
}
</script>
</body>
</html>
