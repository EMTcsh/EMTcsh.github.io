<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¬´ë“±ì‚° íƒë°©ë¡œ í†µì œ ë° ê²½ë¡œ</title>
    <script src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=g2u4orbiqf"></script>
    <style>
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            width: 100%;
            height: 100%;
        }
        .info-window-content {
            padding: 10px;
            font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif;
            font-size: 14px;
        }
        .info-window-content h4 {
            margin: 0 0 5px 0;
        }
        .info-status-red { color: #D32F2F; font-weight: bold; }
        .info-status-orange { color: #FFA000; font-weight: bold; }
        .info-status-green { color: #2E7D32; font-weight: bold; }
    </style>
</head>
<body>
<div id="map"></div>

<script>
    var map = new naver.maps.Map('map', {
        center: new naver.maps.LatLng(35.1117113, 126.998586),
        zoom: 14
    });

    var currentPolyline = null;

    var hikingRoutes = [
        { name: "ì œ2ìˆ˜ì›ì§€ ì…êµ¬", lat: 35.099349, lng: 126.964130, status: "ê°œë°©", reason: "ì •ìƒ ìš´ì˜", path: null },
        { name: "ì œ2ìˆ˜ì›ì§€ ì‹œì‘", lat: 35.101815, lng: 126.964148, status: "ê°œë°©", reason: "ì •ìƒ ìš´ì˜", path: null },
        { name: "ìš©ì¶”ê³„ê³¡ ì…êµ¬", lat: 35.114588, lng: 126.987298, status: "ê°œë°©", reason: "ì •ìƒ ìš´ì˜", path: null },
        { name: "ì„œì„ëŒ€", lat: 35.121206, lng: 127.002936, status: "ê°œë°©", reason: "ì •ìƒ ìš´ì˜", path: null },
        {
            name: "ì¸ì™•ë´‰",
            lat: 35.122144,
            lng: 127.004656,
            status: "ë¶€ë¶„ í†µì œ",
            reason: "ì•ˆì „ ìœ„í—˜",
            path: [
                new naver.maps.LatLng(35.122144, 127.004656),
                new naver.maps.LatLng(35.123542, 127.006422)
            ],
            connectedTo: "ì„œì„ëŒ€"
        },
        { name: "ì¥ë¶ˆì¬", lat: 35.116123, lng: 126.998584, status: "ê°œë°©", reason: "ì •ìƒ ìš´ì˜", path: null },
        { name: "ì¦ì‹¬ìƒê°€", lat: 35.13311035, lng: 126.95649829, status: "ê°œë°©", reason: "ì •ìƒ ìš´ì˜", path: null },
        { name: "ë„ˆì™€ë‚˜ëª©ì¥", lat: 35.104153, lng: 126.992062, status: "ê°œë°©", reason: "ì •ìƒ ìš´ì˜", path: null },
        { name: "ë¬´ë“±ì‚°í¸ë°±ìì—°íœ´ì–‘ë¦¼", lat: 35.093293, lng: 127.026211, status: "ê°œë°©", reason: "ì •ìƒ ìš´ì˜", path: null },
        { name: "ë„ì›ì•¼ì˜ì¥", lat: 35.111098, lng: 127.026909, status: "ê°œë°©", reason: "ì •ìƒ ìš´ì˜", path: null },
        { name: "ë„ì›íƒë°©ì§€ì›ì„¼í„°", lat: 35.114573, lng: 127.029321, status: "ê°œë°©", reason: "ì •ìƒ ìš´ì˜", path: null },
        { name: "ì˜ì‹ ë§ˆì„", lat: 35.119626, lng: 127.033517, status: "ê°œë°©", reason: "ì •ìƒ ìš´ì˜", path: null },
        { name: "ì¸ê³„ë¦¬", lat: 35.124437, lng: 127.033087, status: "ê°œë°©", reason: "ì •ìƒ ìš´ì˜", path: null },
        { name: "ë¬´ë™ì œ", lat: 35.140543, lng: 127.041039, status: "ê°œë°©", reason: "ì •ìƒ ìš´ì˜", path: null },
        { name: "ë¬´ë™ë¦¬", lat: 35.132993, lng: 127.035878, status: "ê°œë°©", reason: "ì •ìƒ ìš´ì˜", path: null },
        { name: "ê²½ìƒë¦¬", lat: 35.152437, lng: 127.041379, status: "ê°œë°©", reason: "ì •ìƒ ìš´ì˜", path: null },
        { name: "ê°€ì•”ë¦¬", lat: 35.159145, lng: 127.052267, status: "ê°œë°©", reason: "ì •ìƒ ìš´ì˜", path: null },
        { name: "ë¶ì‚°", lat: 35.141126, lng: 127.024219, status: "ê°œë°©", reason: "ì •ìƒ ìš´ì˜", path: null }
    ];

    hikingRoutes.forEach(function(item) {
        var statusClass =
            item.status === "í†µì œ" ? "red" :
            item.status === "ë¶€ë¶„ í†µì œ" ? "orange" : "green";

        var marker = new naver.maps.Marker({
            position: new naver.maps.LatLng(item.lat, item.lng),
            map: map,
            title: item.name,
            icon: {
                content:
                    '<div style="width:24px;height:24px;border-radius:50%;background:' + statusClass +
                    ';border:2px solid #fff;text-align:center;line-height:20px;color:#fff;font-weight:bold;">' +
                    (item.status === "ê°œë°©" ? "âœ“" : "!") + '</div>',
                anchor: new naver.maps.Point(12, 12)
            }
        });

        var infoWindow = new naver.maps.InfoWindow({
            content:
                '<div class="info-window-content">' +
                '<h4>' + item.name + '</h4>' +
                '<p><b>ìƒíƒœ:</b> <span class="info-status-' + statusClass + '">' + item.status + '</span></p>' +
                '<p><b>ì‚¬ìœ :</b> ' + item.reason + '</p>' +
                (item.connectedTo ? '<p><b>ê²½ë¡œ:</b> ' + item.connectedTo + ' ë°©ë©´</p>' : '') +
                '</div>'
        });

        naver.maps.Event.addListener(marker, 'click', function () {
            if (infoWindow.getMap()) {
                infoWindow.close();
            } else {
                infoWindow.open(map, marker);
            }

            if (currentPolyline) {
                currentPolyline.setMap(null);
                currentPolyline = null;
            }

            if (item.path) {
                currentPolyline = new naver.maps.Polyline({
                    map: map,
                    path: item.path,
                    strokeColor: '#007BFF',
                    strokeOpacity: 0.8,
                    strokeWeight: 5
                });
            }
        });
    });
</script>
  <script>
var map = new naver.maps.Map('map', {
    center: new naver.maps.LatLng(35.1117113, 126.998586),
    zoom: 14
});

var markers = [];
var infoWindows = [];

function loadSheetData() {
    fetch("ğŸ”—ì—¬ê¸°ì—_AppsScript_URL")
        .then(res => res.json())
        .then(data => {
            // ê¸°ì¡´ ë§ˆì»¤ ì œê±°
            markers.forEach(m => m.setMap(null));
            markers = [];

            data.forEach(item => {
                const statusClass =
                    item.status === "í†µì œ" ? "red" :
                    item.status === "ë¶€ë¶„ í†µì œ" ? "orange" : "green";

                const marker = new naver.maps.Marker({
                    map: map,
                    position: new naver.maps.LatLng(item.lat, item.lng),
                    title: item.name,
                    icon: {
                        content:
                            `<div style="width:24px;height:24px;border-radius:50%;
                            background:${statusClass};
                            border:2px solid #fff;
                            text-align:center;
                            line-height:20px;
                            color:#fff;
                            font-weight:bold;">
                            ${item.status === "ê°œë°©" ? "âœ“" : "!"}
                            </div>`,
                        anchor: new naver.maps.Point(12, 12)
                    }
                });

                const infoWindow = new naver.maps.InfoWindow({
                    content:
                        `<div class="info-window-content">
                            <h4>${item.name}</h4>
                            <p><b>ìƒíƒœ:</b> <span class="info-status-${statusClass}">
                            ${item.status}</span></p>
                            <p><b>ì‚¬ìœ :</b> ${item.reason}</p>
                        </div>`
                });

                naver.maps.Event.addListener(marker, 'click', () => {
                    infoWindow.open(map, marker);
                });

                markers.push(marker);
            });
        });
}

// ìµœì´ˆ ë¡œë”©
loadSheetData();

// â±ï¸ 1ë¶„ë§ˆë‹¤ ìë™ ê°±ì‹  (ì„ íƒ)
setInterval(loadSheetData, 60000);
</script>
</body>
</html>
