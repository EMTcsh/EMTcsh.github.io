<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸš‘ íŠ¹ìˆ˜ì‚°ì•…êµ¬ì¡°íŒ€ í™˜ìí‰ê°€ ê¸°ë¡</title>
<script src="https://cdn.tailwindcss.com"></script>
<script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=ff9e145029506d6e4c72d1f2b01ea424&libraries=services"></script>
<style>
body { background-color: #f0f2f5; font-family: Arial, sans-serif; }
.container { max-width: 900px; margin: 20px auto; padding: 20px; }
.section { background-color: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px; }
.section h2 { font-size: 1.25rem; color: #1e3a8a; margin-bottom: 10px; }
input, select, textarea { border: 1px solid #cbd5e1; border-radius: 8px; padding: 10px; width: 100%; margin-bottom: 10px; font-size: 1rem; }
textarea { resize: vertical; min-height: 80px; }
button { border-radius: 8px; font-weight: bold; }
.board-item { white-space: pre-line; background-color: #f8fafc; padding: 12px; border-radius: 8px; margin-bottom: 10px; }
.vitalsRow { border: 1px dashed #cbd5e1; border-radius: 8px; padding: 10px; margin-bottom: 10px; background-color: #fefefe; }
.coordinate-box { background-color: #e2e8f0; border-radius: 8px; padding: 10px; margin-bottom: 10px; word-break: break-word; }
#map { width: 100%; height: 300px; border-radius: 12px; margin-bottom: 10px; }
.GPS-link a { display: block; text-align: center; padding: 10px; margin: 5px 0; background-color: #e0e7ff; border-radius: 8px; font-weight: bold; color: #1e40af; text-decoration: none; }
</style>
</head>
<body>
<div class="container">
<h1 class="text-2xl font-bold text-center text-blue-700 mb-4">ğŸš‘ íŠ¹ìˆ˜ì‚°ì•…êµ¬ì¡°íŒ€ í™˜ìí‰ê°€ ê¸°ë¡</h1>

<div class="section">
    <p>ì‚°ì•…êµ¬ì¡°íŒ€ í˜„ì¥ëŒ€ì‘ë ¥ í–¥ìƒì„ ìœ„í•´ ì œì‘í•¨.</p>
    <p class="mt-2 text-sm text-gray-500">Â© 2024 Paramedic Web Applications | EMT Ver.0.9.28 | Korea National Park Service Paramedic Lab</p>
</div>

<form id="recordForm">

  <!-- ================== í˜„ì¥ ì •ë³´ ================== -->
  <div class="section">
    <h2 class="text-xl font-semibold mb-2">í˜„ì¥ ì •ë³´</h2>
    <label>ë„ì°©ì‹œê°„: <input type="datetime-local" name="ë°œìƒì‹œê°„" required></label><br>
    <label>ì‚¬ê³ ì¥ì†Œ: <input type="text" name="ì¥ì†Œ" placeholder="ì˜ˆ: ë¬´ë“±ì‚° OOì¼ì›" required></label><br>
    <label>í™˜ìì¦ìƒ: <input type="text" name="ì£¼ì¦ìƒ" placeholder="ì˜ˆ: í˜¸í¡ê³¤ë€, ê°€ìŠ´ í†µì¦" required></label>
  </div>

  <!-- ================== GCS ================== -->
  <div class="section">
    <h2 class="text-xl font-semibold">Glasgow Coma Scale (GCS)</h2>
    <label>ëˆˆ ë°˜ì‘ (E)</label>
    <select id="eye">
      <option value="4">ìë°œì ìœ¼ë¡œ ì—´ë¦¼</option>
      <option value="3">ì†Œë¦¬ ìê·¹ì— ì—´ë¦¼</option>
      <option value="2">í†µì¦ ìê·¹ì— ì—´ë¦¼</option>
      <option value="1">ì „í˜€ ì—´ë¦¼ ì•ˆí•¨</option>
    </select>
    <label>ì–¸ì–´ ë°˜ì‘ (V)</label>
    <select id="verbal">
      <option value="5">ì •í™•í•œ ëŒ€ë‹µ</option>
      <option value="4">í˜¼ì¡í•œ ëŒ€ë‹µ</option>
      <option value="3">í˜¼ë¯¸í•œ ëŒ€ë‹µ</option>
      <option value="2">ëª¨í˜¸í•œ ëŒ€ë‹µ</option>
      <option value="1">ì‘ë‹µ ì—†ìŒ</option>
    </select>
    <label>ìš´ë™ ë°˜ì‘ (M)</label>
    <select id="motor">
      <option value="6">ëª…ë ¹ ìˆ˜í–‰</option>
      <option value="5">í†µì¦ ìê·¹ì— êµ­ì†Œí™”</option>
      <option value="4">í†µì¦ ìê·¹ì— êµ´ê³¡</option>
      <option value="3">í†µì¦ ìê·¹ì— êµ¬ë¶€ë¦¬ê¸°</option>
      <option value="2">ê²½ë ¨</option>
      <option value="1">ìš´ë™ ì—†ìŒ</option>
    </select>
    <div id="gcsResultContainer" style="margin-top:10px; display:none;">
      <strong>GCS ê²°ê³¼:</strong> <span id="gcsResult"></span>
    </div>
  </div>

  <!-- ================== í™˜ì ì •ë³´ ================== -->
  <div class="section">
    <h2 class="text-xl font-semibold mb-2">í™˜ì ì •ë³´</h2>
    <label>ì´ë¦„: <input type="text" name="í™˜ìì´ë¦„" required></label><br>
    <label>ìƒë…„ì›”ì¼: <input type="date" name="ìƒë…„ì›”ì¼" required></label>
  </div>
  
  <!-- ================== ì‘ê¸‰ì²˜ì¹˜ ================== -->
  <div class="section">
    <h2 class="text-xl font-semibold mb-2">ì‘ê¸‰ì²˜ì¹˜</h2>
    <textarea name="ì‘ê¸‰ì²˜ì¹˜" rows="4" placeholder="SAMPLE, ì‹¤ì‹œí•œ ì‘ê¸‰ì²˜ì¹˜ ê¸°ë¡"></textarea>
  </div>
    
  <!-- ================== í™œë ¥ì§•í›„ ================== -->
  <div class="section">
    <h2 class="text-xl font-semibold mb-2">í™œë ¥ì§•í›„ (ì—¬ëŸ¬ íšŒ ì¸¡ì • ê°€ëŠ¥)</h2>
    <div id="vitalSignsContainer"></div>
    <button type="button" onclick="addVitalSigns()" class="bg-green-600 text-white px-3 py-1 rounded">+ í™œë ¥ì§•í›„ ì¶”ê°€</button>
  </div>

  <!-- ================== ê¸°ë¡ì ================== -->
  <div class="section">
    <h2 class="text-xl font-semibold">ê¸°ë¡ì</h2>
    <input type="text" name="ê¸°ë¡ì" placeholder="êµ¬ì¡°ëŒ€ì› ì„±ëª…" required>
  </div>

  <button type="submit" class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg">ê¸°ë¡ ì €ì¥í•˜ê¸°</button>
  <button type="button" onclick="shareReport()" class="w-full bg-purple-500 text-white py-3 px-4 rounded-lg mt-2">ê³µìœ </button>
  <div id="resultMessage" class="mt-4 text-center"></div>
</form>

<!-- ================== ì‘ì„±ê¸°ë¡ ================== -->
<div class="section">
  <h2 class="text-xl font-semibold">ì‘ì„±ê¸°ë¡</h2>
  <div id="savedData" class="board"></div>
</div>

<!-- ================== GPS ì¢Œí‘œ ================== -->
<div class="section">
    <h2 class="text-xl font-semibold">GPS ì¢Œí‘œ</h2>
    <button id="getLocation" class="bg-green-600 text-white px-3 py-1 rounded">ğŸŒ ë‚´ ìœ„ì¹˜ í™•ì¸</button>
    <button id="shareLocation" class="bg-blue-500 text-white px-3 py-1 rounded">ğŸ“² ìœ„ì¹˜ ê³µìœ </button>

    <div class="coordinate-box" id="locationDisplay">ìœ„ë„: , ê²½ë„: </div>
    <div class="coordinate-box" id="dmsCoordinates">ë„ë¶„ì´ˆ: </div>
    <div id="map"></div>
</div>

<div class="GPS-link">
  <a href="https://www.whereurl.com/" target="_blank">ì¡°ë‚œì ìœ„ì¹˜ê³µìœ  whereUrl</a>
</div>
<div class="GPS-link">
  <a href="https://discord.gg/ryaMRTAhwP" target="_blank">ë¬¸ì˜: ğŸ¸ êµ­ë¦½ê³µì› ì•ˆì „ì‚¬ê³  ì—°êµ¬íšŒ</a>
</div>

<script>
/* ===== í™œë ¥ì§•í›„ ì¶”ê°€ ===== */
function addVitalSigns() {
    const container = document.getElementById("vitalSignsContainer");
    const index = container.children.length + 1;
    const div = document.createElement("div");
    div.className = "vitalsRow";
    div.innerHTML = `
        <strong>${index}íšŒì°¨ ì¸¡ì •</strong><br>
        í˜ˆì••: <input type="text" name="í˜ˆì••[]" placeholder="120/80"><br>
        ë§¥ë°•: <input type="number" name="ë§¥ë°•[]" placeholder="íšŒ/ë¶„"><br>
        í˜¸í¡ìˆ˜: <input type="number" name="í˜¸í¡ìˆ˜[]" placeholder="íšŒ/ë¶„"><br>
        ì²´ì˜¨: <input type="number" step="0.1" name="ì²´ì˜¨[]" placeholder="â„ƒ"><br>
        SpOâ‚‚: <input type="number" name="ì‚°ì†Œí¬í™”ë„[]" placeholder="%"><br>
    `;
    container.appendChild(div);
}
addVitalSigns();

/* ===== GCS ê³„ì‚° ===== */
function calculateGCS() {
    const eye = parseInt(document.getElementById("eye").value);
    const verbal = parseInt(document.getElementById("verbal").value);
    const motor = parseInt(document.getElementById("motor").value);
    const total = eye + verbal + motor;
    let state = '';
    if(total === 15) state='ì •ìƒ';
    else if(total >=13) state='ì¡¸ë¦¼';
    else if(total >=9) state='í˜¼ë¯¸';
    else if(total >=4) state='ë°˜í˜¼ìˆ˜';
    else state='í˜¼ìˆ˜';
    document.getElementById("gcsResult").innerText = `${total}ì  (${state})`;
    document.getElementById("gcsResultContainer").style.display="block";
}
["eye","verbal","motor"].forEach(id=>document.getElementById(id).addEventListener("change",calculateGCS));
calculateGCS();

/* ===== ê¸°ë¡ ì €ì¥ ===== */
document.getElementById("recordForm").addEventListener("submit", function(e){
    e.preventDefault();
    const form = document.getElementById("recordForm");
    const formData = new FormData(form);
    const data = {};

    // GCS ê°’ ì €ì¥
    data["GCS"] = document.getElementById("gcsResult").innerText;

    // ë‚˜ë¨¸ì§€ í¼ ë°ì´í„° ì²˜ë¦¬
    for(const [key,value] of formData.entries()){
        if(key.endsWith("[]")){
            const baseKey = key.replace("[]","");
            if(!data[baseKey]) data[baseKey]=[];
            data[baseKey].push(value);
        } else {
            data[key] = value;
        }
    }

    // í…ìŠ¤íŠ¸ ë³€í™˜
    let content = "";
    Object.keys(data).forEach(key=>{
        if(Array.isArray(data[key])) content+=`${key}: ${data[key].join(", ")}\n`;
        else content+=`${key}: ${data[key]}\n`;
    });

    const today = new Date().toISOString().slice(0,10);
    const blob = new Blob([content],{type:"text/plain"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href=url;
    a.download=`íŠ¹ìˆ˜ì‚°ì•…êµ¬ì¡°íŒ€ í™˜ìí‰ê°€_${today}.txt`;
    a.click();
    a.remove();
    URL.revokeObjectURL(url);

    document.getElementById("savedData").innerHTML = `<div class="board-item">${content}</div>`;
    document.getElementById("resultMessage").innerText = "ê¸°ë¡ ì €ì¥ ì™„ë£Œ âœ…";
});

/* ===== ê³µìœ  ===== */
function shareReport(){
    const form = document.getElementById("recordForm");
    const formData = new FormData(form);
    let text = "";
    formData.forEach((value,key)=>{ text+=`${key}: ${value}\n`; });
    text += "GCS: "+document.getElementById("gcsResult").innerText;

    if(navigator.share){
        navigator.share({title:"íŠ¹ìˆ˜ì‚°ì•…êµ¬ì¡°íŒ€ í™˜ì í‰ê°€ ê¸°ë¡", text});
    } else {
        alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ê³µìœ  ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
    }
}

/* ===== GPS ì¢Œí‘œ ===== */
let map, marker, currentLat, currentLng;
function initMap(lat, lng) {
    map = new kakao.maps.Map(document.getElementById('map'), {
        center: new kakao.maps.LatLng(lat, lng),
        level: 3
    });
    marker = new kakao.maps.Marker({
        position: new kakao.maps.LatLng(lat, lng),
        map: map
    });
}
document.getElementById('getLocation').addEventListener('click', function() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition, showError);
    } else {
        alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
    }
});
function showPosition(position) {
    currentLat = position.coords.latitude;
    currentLng = position.coords.longitude;
    document.getElementById('locationDisplay').textContent = `ìœ„ë„: ${currentLat}, ê²½ë„: ${currentLng}`;
    let dmsLat = convertToDMS(currentLat, 'lat');
    let dmsLng = convertToDMS(currentLng, 'lng');
    document.getElementById('dmsCoordinates').textContent = `ë„ë¶„ì´ˆ: ${dmsLat}, ${dmsLng}`;
    initMap(currentLat, currentLng);
}
function showError(error) {
    switch(error.code) {
        case error.PERMISSION_DENIED: alert("ì‚¬ìš©ìê°€ ìœ„ì¹˜ ì •ë³´ë¥¼ ìš”ì²­í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."); break;
        case error.POSITION_UNAVAILABLE: alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."); break;
        case error.TIMEOUT: alert("ìœ„ì¹˜ ì •ë³´ ìš”ì²­ì´ ì‹œê°„ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤."); break;
        case error.UNKNOWN_ERROR: alert("ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."); break;
    }
}
function convertToDMS(degree, type) {
    let d = Math.floor(degree);
    let m = Math.floor((degree - d) * 60);
    let s = ((degree - d - m/60) * 3600).toFixed(2);
    return `${d}Â° ${m}' ${s}" ${type==='lat'? (degree>0?'N':'S'):(degree>0?'E':'W')}`;
}
document.getElementById("shareLocation").addEventListener("click", function() {
    if(currentLat && currentLng){
        const googleMapLink = `https://www.google.com/maps?q=${currentLat},${currentLng}`;
        const kakaoMapLink = `https://map.kakao.com/link/map/Location,${currentLat},${currentLng}`;
        const shareMessage = `ğŸš¨ ìš”êµ¬ì¡°ì í˜„ìœ„ì¹˜ ì¢Œí‘œ:\nìœ„ë„: ${currentLat}\nê²½ë„: ${currentLng}\nGoogle Map: ${googleMapLink}\nKakao Map: ${kakaoMapLink}`;
        if(navigator.share){
            navigator.share({title:"[êµ¬ì¡°ìš”ì²­] GPSì¢Œí‘œ ê³µìœ ", text: shareMessage, url:kakaoMapLink});
        } else {
            alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ìœ„ì¹˜ ê³µìœ ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\n' + shareMessage);
        }
    } else alert('ìœ„ì¹˜ë¥¼ ë¨¼ì € í™•ì¸í•œ í›„ ê³µìœ í•˜ì„¸ìš”.');
});
</script>
</div>
</body>
</html>
