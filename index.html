<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸš‘ ë¬´ë“±ì‚° ì‚°ì•…ì‚¬ê³  ê¸°ë¡</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=ff9e145029506d6e4c72d1f2b01ea424&libraries=services"></script>

<style>
body {
  background: #f0f2f5;
  font-family: Arial, sans-serif;
  line-height: 1.6;
}
.container {
  max-width: 900px;
  margin: 24px auto;
  padding: 20px;
}
.section {
  background: #ffffff;
  border-radius: 14px;
  padding: 24px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  margin-bottom: 28px;
}
.section h2 {
  margin-bottom: 16px;
  padding-bottom: 8px;
  border-bottom: 1px solid #e5e7eb;
  color: #1e3a8a;
}
input,
select,
textarea {
  border: 1px solid #cbd5e1;
  border-radius: 10px;
  padding: 12px 14px;
  width: 100%;
  margin-bottom: 16px;
  font-size: 1rem;
  background-color: #ffffff;
}
input:focus,
select:focus,
textarea:focus {
  outline: none;
  border-color: #3b82f6;
  box-shadow: 0 0 0 2px rgba(59,130,246,0.15);
}
textarea {
  min-height: 140px;
  resize: vertical;
  line-height: 1.7;
}
.coordinate-box {
  background: #eef2ff;
  padding: 12px 14px;
  border-radius: 10px;
  margin-bottom: 12px;
  font-weight: 500;
}
#map {
  width: 100%;
  height: 320px;
  border-radius: 14px;
  margin-top: 12px;
}
.board-item {
  white-space: pre-line;
  background: #f8fafc;
  padding: 16px;
  border-radius: 12px;
  line-height: 1.6;
  font-size: 0.95rem;
}
button {
  font-size: 1.05rem;
}
</style>
</head>

<body>
<div class="container">

<h1 class="text-2xl font-bold text-center text-blue-700 mb-6">
ë¬´ë“±ì‚° ì‚°ì•…ì‚¬ê³  ê¸°ë¡
</h1>

<form id="recordForm">

<!-- í˜„ì¥ì •ë³´ -->
<div class="section">
<h2 class="text-xl font-semibold">í˜„ì¥ì •ë³´</h2>

<!-- âœ… ì¶œë™ëŒ€ì› ì´ë¦„ ì¶”ê°€ -->
<input type="text" name="ì¶œë™ëŒ€ì›" placeholder="ì¶œë™ëŒ€ì› ì´ë¦„ (ì˜ˆ: í™ê¸¸ë™, ê¹€êµ¬ì¡°)" required>

<input type="datetime-local" name="ë„ì°©ì‹œê°„" required>
<input type="text" name="ì‚¬ê³ ì¥ì†Œ" placeholder="ì‚¬ê³ ì¥ì†Œ" required>
<input type="text" name="ì£¼ì¦ìƒ" placeholder="í™˜ì ì¦ìƒ" required>  

<div id="locationDisplay" class="coordinate-box">ìœ„ë„: , ê²½ë„:</div>

<button type="button" id="getLocation"
class="bg-green-600 text-white px-4 py-2 rounded">
ğŸŒ í˜„ì¥ë„ì°© ì¢Œí‘œ
</button>

<input type="hidden" name="ì‚¬ê³ ì¢Œí‘œ" id="hiddenCoordinate">
<div id="map"></div>
</div>

<!-- ===== GCS ===== -->
<div class="section">
    <h2 class="text-xl font-semibold">ì˜ì‹ìˆ˜ì¤€ í‰ê°€(GCS)</h2>

    <label>ëˆˆ ëœ¨ê¸° ë°˜ì‘ (E)</label>
    <select id="eye">
        <option value="4">ìë°œì ìœ¼ë¡œ ëˆˆì„ ëœ¬ë‹¤</option>
        <option value="3">ë§ë¡œ ì§€ì‹œí–ˆì„ë•Œ ëˆˆì„ ëœ¬ë‹¤</option>
        <option value="2">í†µì¦ ìê·¹ì— ì˜í•´ ëˆˆì„ ëœ¬ë‹¤</option>
        <option value="1">ì–´ë– í•œ ìê·¹ì—ë„ ëˆˆì„ ëœ¨ì§€ ëª»í•œë‹¤</option>
    </select>

    <label>ì–¸ì–´ ë°˜ì‘ (V)</label>
    <select id="verbal">
        <option value="5">ì •í™•í•œ ë°˜ì‘(6í•˜ì›ì¹™ì— ì§€ë‚¨ë ¥ ìˆëŠ” ìƒíƒœ)</option>
        <option value="4">ëŒ€í™” í˜¼ë€(ëŒ€í™”ê°€ëŠ¥í•˜ë‚˜, ê³„ì†ì  ëŒ€í™” êµí™˜ ì•ˆë¨)</option>
        <option value="3">ì–¸ì–´í˜¼ë€(ë™ë¬¸ì„œë‹µ, í˜¼ë€ëœ ë§ì„ í•¨)</option>
        <option value="2">ì´í•´ í• ìˆ˜ ì—†ëŠ” ì†Œë¦¬(ì‹ ìŒì†Œë¦¬ë§Œ)</option>
        <option value="1">ë°˜ì‘ì´ ì—†ìŒ(ì•„ë¬´ëŸ° ì†Œë¦¬ë¥¼ ë‚´ì§€ ì•ŠìŒ)</option>
    </select>

    <label>ìš´ë™ ë°˜ì‘ (M)</label>
    <select id="motor">
        <option value="6">ëª…ë ¹ì— ë”°ë¦„(ê°„ë‹¨í•œ ëª…ë ¹ì— ë”°ë¼ ìš´ë™ê¸°ëŠ¥ ìˆ˜í–‰)</option>
        <option value="5">í†µì¦ ìê·¹ êµ­ì†Œí™” ë°˜ì‘(ëª…ë ¹ì€ ë”°ì§€ ì•Šì§€ë§Œ, ìê·¹ì„ ê°€í•˜ë©´ í”¼í•˜ê±°ë‚˜ ì¹˜ìš°ë ¤ê³  í•¨) </option>
        <option value="4">í†µì¦ ìê·¹ ì›€ì¸ ë¦¼(í†µì¦ ìê·¹ì„ í”¼í•˜ë ¤ê³  í•¨, ì¹˜ìš°ë ¤ê³  í•˜ì§€ëŠ” ì•ŠìŒ)</option>
        <option value="3">í†µì¦ ìê·¹ ì´ìƒêµ´ê³¡(í†µì¦ ìê·¹ì— ì•ìœ¼ë¡œ êµ¬ë¶€ë¦¬ê±°ë‚˜ ëª¸ìª½ìœ¼ë¡œ ì ‘ìŒ)</option>
        <option value="2">í†µì¦ ìê·¹ ì´ìƒì‹ ì „(í†µì¦ ìê·¹ì— ë’¤ë¡œ ì –íˆê±°ë‚˜ ëª¨ì—ì„œ ë©€ë¦¬ ë»—ìŒ)(</option>
        <option value="1">ì „í˜€ ì›€ì§ì´ì§€ ì•ŠìŒ(ë¬´ë°˜ì‘, ìê°€í˜¸í¡ ì—†ìŒ)</option>
    </select>

    <div id="gcsResultContainer" style="margin-top:10px; display:none;">
        <strong>ì˜ì‹í‰ê°€(GCS) ê²°ê³¼:</strong>
        <span id="gcsResult"></span>
    </div>
</div>

<!-- í™˜ìì •ë³´ -->
<div class="section">
<h2 class="text-xl font-semibold">í™˜ìì •ë³´</h2>

<input type="text" name="í™˜ìì´ë¦„" placeholder="ì´ë¦„" required>
<input type="date" name="ìƒë…„ì›”ì¼" required>
<input type="text" name="ê±°ì£¼ì§€" placeholder="ê±°ì£¼ì§€" required>
<input type="tel" name="ì—°ë½ì²˜" placeholder="ì—°ë½ì²˜ (ì˜ˆ: 010-1234-5678)" required>
</div>

<!-- ì‘ê¸‰ì²˜ì¹˜ -->
<div class="section">
<h2 class="text-xl font-semibold">ì‘ê¸‰ì²˜ì¹˜</h2>
<textarea name="ì‘ê¸‰ì²˜ì¹˜"></textarea>
</div>

<button type="submit"
class="w-full bg-blue-600 text-white py-4 rounded">
ê¸°ë¡ ì €ì¥ ë° ê³µìœ 
</button>

</form>

<div class="section">
<h2 class="text-xl font-semibold">ì‘ì„±ê¸°ë¡</h2>
<div id="savedData"></div>
</div>

</div>

<script>
const GOOGLE_SCRIPT_URL =
"https://script.google.com/macros/s/AKfycbxm_oLeGMIGh5PRokCURztVx6-1Ijug2KtuGbsFH-cZVOKE5LgaKDnLbTgFl2sWWDdkwA/exec";

/* ===== GCS ê³„ì‚° ===== */
function calculateGCS() {
    const e = parseInt(document.getElementById("eye").value);
    const v = parseInt(document.getElementById("verbal").value);
    const m = parseInt(document.getElementById("motor").value);

    const total = e + v + m;

    let state = '';
    if (total === 15) state = 'ì •ìƒ-alert';
    else if (total >= 13) state = 'ì¡¸ë¦¼-drowsy';
    else if (total >= 9) state = 'í˜¼ë¯¸-stupor';
    else if (total >= 4) state = 'ë°˜í˜¼ìˆ˜-semicoma';
    else state = 'í˜¼ìˆ˜-coma';

    document.getElementById("gcsResult").innerText = `${total}ì  (${state})`;
    document.getElementById("gcsResultContainer").style.display = "block";
}

["eye","verbal","motor"].forEach(id => {
    document.getElementById(id).addEventListener("change", calculateGCS);
});
calculateGCS();

  
/* GPS */
getLocation.onclick = () => {
  navigator.geolocation.getCurrentPosition(p => {
    const lat = p.coords.latitude;
    const lng = p.coords.longitude;
    const txt = `ìœ„ë„:${lat}, ê²½ë„:${lng}`;
    locationDisplay.textContent = txt;
    hiddenCoordinate.value = txt;

    const loc = new kakao.maps.LatLng(lat, lng);
    const map = new kakao.maps.Map(document.getElementById("map"), {
      center: loc,
      level: 3
    });
    new kakao.maps.Marker({ position: loc, map });
  });
};

/* ì €ì¥ + ì „ì†¡ + ê³µìœ  */
recordForm.onsubmit = async e => {
  e.preventDefault();

  let data = {}, text = "";
  new FormData(recordForm).forEach((v,k)=>{
    data[k]=v;
    text+=`${k}: ${v}\n`;
  });

  data["GCS"] = gcsResult.textContent;
  text += `GCS: ${gcsResult.textContent}`;

  savedData.innerHTML = `<div class="board-item">${text}</div>`;

  const blob = new Blob([text], {type:"text/plain"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "ë¬´ë“±ì‚°_í™˜ìê¸°ë¡.txt";
  a.click();

  fetch(GOOGLE_SCRIPT_URL,{
    method:"POST",
    body:JSON.stringify(data)
  }).catch(()=>{});

  if(navigator.share){
    navigator.share({
      title:"ë¬´ë“±ì‚° ì‚°ì•…ì‚¬ê³  ê¸°ë¡",
      text:text
    });
  }
};
</script>

</body>
</html>
