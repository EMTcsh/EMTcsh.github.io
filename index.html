<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸš‘ ë¬´ë“±ì‚° ì‚°ì•…ì‚¬ê³  êµ¬ê¸‰ ê¸°ë¡</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=ff9e145029506d6e4c72d1f2b01ea424&libraries"></script>

<style>
body{background:#eef1f5;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;}
.critical-mode{animation:criticalFlash 0.8s infinite;}
@keyframes criticalFlash{
0%{background:#fee2e2;}
50%{background:#dc2626;}
100%{background:#fee2e2;}
}
.card{
background:#fff;border-radius:14px;padding:16px;margin-bottom:16px;
box-shadow:0 2px 8px rgba(0,0,0,0.05);border-left:5px solid #2563eb;}
.card h2{font-weight:700;font-size:15px;margin-bottom:10px;color:#1e3a8a;}
input,select,textarea{width:100%;border:1px solid #d1d5db;border-radius:10px;padding:12px;margin-bottom:10px;font-size:15px;background:#f9fafb;}
textarea{min-height:100px;}
button{width:100%;padding:14px;border-radius:12px;font-size:16px;font-weight:600;}
.coordinate-box{background:#e0e7ff;padding:10px;border-radius:8px;font-size:13px;margin-bottom:8px;}
#map{width:100%;height:220px;border-radius:12px;}
</style>
</head>

<body id="mainBody" class="px-4">

<div class="text-center font-bold text-xl my-4 text-blue-700">
ğŸš‘ ë¬´ë“±ì‚° ì‚°ì•…ì‚¬ê³  êµ¬ê¸‰ ê¸°ë¡
</div>

<form id="recordForm">

<div class="card">
<h2>ğŸ“ í˜„ì¥ì •ë³´</h2>
<input type="text" name="ì¶œë™ëŒ€ì›" placeholder="ì¶œë™ëŒ€ì› ì´ë¦„" required>
<input type="datetime-local" name="ë„ì°©ì‹œê°„" required>
<input type="text" name="ì‚¬ê³ ì¥ì†Œ" placeholder="ì‚¬ê³ ì¥ì†Œ" required>
<input type="text" name="ì£¼ì¦ìƒ" placeholder="í™˜ì ì¦ìƒ" required>

<div id="locationDisplay" class="coordinate-box">ìœ„ë„: -, ê²½ë„: -</div>
<button type="button" id="getLocation" class="bg-green-600 text-white mb-2">ğŸŒ í˜„ì¥ ì¢Œí‘œ ê°€ì ¸ì˜¤ê¸°</button>
<input type="hidden" name="ì‚¬ê³ ì¢Œí‘œ" id="hiddenCoordinate">
<div id="map"></div>
</div>

<div class="card">
<h2>ğŸ§  GCS</h2>
<select id="eye">
<option value="4">ìë°œì </option>
<option value="3">ì–¸ì–´ë°˜ì‘</option>
<option value="2">í†µì¦ë°˜ì‘</option>
<option value="1">ë¬´ë°˜ì‘</option>
</select>
<select id="verbal">
<option value="5">ì •í™•</option>
<option value="4">í˜¼ë€</option>
<option value="3">ë¶€ì ì ˆ</option>
<option value="2">ì‹ ìŒ</option>
<option value="1">ë¬´ë°˜ì‘</option>
</select>
<select id="motor">
<option value="6">ëª…ë ¹ìˆ˜í–‰</option>
<option value="5">êµ­ì†Œí™”</option>
<option value="4">íšŒí”¼</option>
<option value="3">êµ´ê³¡</option>
<option value="2">ì‹ ì „</option>
<option value="1">ë¬´ë°˜ì‘</option>
</select>

<div class="font-bold text-lg mt-2">
GCS: <span id="gcsResult"></span>
</div>

<div id="gcsWarning" style="display:none;padding:10px;border-radius:10px;background:#fee2e2;color:#b91c1c;font-weight:600;">
ğŸš¨ ì¤‘ì¦ ì˜ì‹ì €í•˜ â€” ì¦‰ì‹œ ABC í™•ì¸
</div>
</div>

<div class="card">
<h2>ğŸ‘¤ í™˜ìì •ë³´</h2>
<input type="text" name="í™˜ìì´ë¦„" required>
<input type="date" name="ìƒë…„ì›”ì¼" required>
<input type="text" name="ê±°ì£¼ì§€" required>
<input type="tel" name="ì—°ë½ì²˜" required>
</div>

<div class="card">
<h2>ğŸš¨ ì‘ê¸‰ì²˜ì¹˜</h2>
<textarea name="ì‘ê¸‰ì²˜ì¹˜"></textarea>
</div>

<button type="submit" class="bg-blue-600 text-white mb-4">
ğŸ’¾ ì €ì¥ + ê³µìœ 
</button>

</form>

<script>
const SERVER_URL="https://script.google.com/macros/s/AKfycbzlomCAxIqxNLLLXeoI_7PZzP9WguNFk3OH84Nzgcxhncm1mLx6LuqNbcAgniODAFgDIQ/exec";
let fieldMap;
let criticalSpoken=false;

/* ğŸ”Š ì¤‘ì¦í™˜ì ìŒì„± ì•ˆë‚´ */
function speakCritical(){
speechSynthesis.cancel();
const msg=new SpeechSynthesisUtterance(
"ì¤‘ì¦í™˜ìì…ë‹ˆë‹¤. ê¸°ë„ì™€ í˜¸í¡ì„ í™•ë³´í•˜ì„¸ìš”."
);
msg.lang="ko-KR"; msg.rate=0.95; msg.pitch=1; msg.volume=1;
speechSynthesis.speak(msg);
}

function calculateGCS(){
const total=parseInt(eye.value)+parseInt(verbal.value)+parseInt(motor.value);
gcsResult.textContent=total+"ì ";
if(total<=8){
gcsWarning.style.display="block";
mainBody.classList.add("critical-mode");
if(!criticalSpoken){speakCritical();navigator.vibrate?.([300,100,300]);criticalSpoken=true;}
}else{
gcsWarning.style.display="none";
mainBody.classList.remove("critical-mode");
criticalSpoken=false;
}
}
[eye,verbal,motor].forEach(el=>el.addEventListener("change",calculateGCS));
calculateGCS();

/* GPS ì¢Œí‘œ */
getLocation.onclick=()=>{
navigator.geolocation.getCurrentPosition(p=>{
const lat=p.coords.latitude;
const lng=p.coords.longitude;
locationDisplay.textContent=`ìœ„ë„:${lat}, ê²½ë„:${lng}`;
hiddenCoordinate.value=`${lat},${lng}`;
const loc=new kakao.maps.LatLng(lat,lng);
fieldMap=new kakao.maps.Map(document.getElementById("map"),{center:loc,level:3});
new kakao.maps.Marker({position:loc,map:fieldMap});
});
};

/* ì €ì¥ + ê³µìœ  */
recordForm.onsubmit=async e=>{
e.preventDefault();
const data={};
new FormData(recordForm).forEach((v,k)=>data[k]=v);
data.GCS=gcsResult.textContent;

if(data.ì‚¬ê³ ì¢Œí‘œ){const sp=data.ì‚¬ê³ ì¢Œí‘œ.split(",");data.latitude=sp[0];data.longitude=sp[1];}

/* Google Sheet ì „ì†¡ */
await fetch(SERVER_URL,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify(data)
});

/* ê³µìœ  ë©”ì‹œì§€ */
const shareText=
`ğŸš‘ ë¬´ë“±ì‚° ì‚°ì•…ì‚¬ê³  êµ¬ê¸‰ê¸°ë¡
ì¶œë™ëŒ€ì›: ${data.ì¶œë™ëŒ€ì›}
í™˜ì: ${data.í™˜ìì´ë¦„}
GCS: ${data.GCS}
ì¦ìƒ: ${data.ì£¼ì¦ìƒ}
ìœ„ì¹˜: ${data.latitude||"-"}, ${data.longitude||"-"}`;

/* ëª¨ë°”ì¼ ê³µìœ  / PC í´ë¦½ë³´ë“œ ë³µì‚¬ */
if(navigator.share){
try{await navigator.share({title:"ì‚°ì•…ì‚¬ê³  êµ¬ê¸‰ê¸°ë¡",text:shareText});}
catch(err){}
}else{
await navigator.clipboard.writeText(shareText);
alert("ì €ì¥ ì™„ë£Œ\nê³µìœ  ë‚´ìš©ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
return;
}

alert("ì €ì¥ ë° ê³µìœ  ì™„ë£Œ");
};
</script>

</body>
</html>
