<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸš‘ ë¬´ë“±ì‚°ì‚°ì•…ì‚¬ê³  ëŒ€ì‘ ê¸°ë¡</title>
<script src="https://cdn.tailwindcss.com"></script>
<script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=ff9e145029506d6e4c72d1f2b01ea424&libraries=services"></script>

<style>
body { background-color: #f0f2f5; font-family: Arial, sans-serif; }
.container { max-width: 900px; margin: 20px auto; padding: 20px; }
.section { background-color: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px; }
.section h2 { font-size: 1.25rem; color: #1e3a8a; margin-bottom: 10px; }
input, select, textarea { border: 1px solid #cbd5e1; border-radius: 8px; padding: 10px; width: 100%; margin-bottom: 10px; font-size: 1rem; }
textarea { resize: vertical; min-height: 80px; }
button { border-radius: 8px; font-weight: bold; }
.board-item { white-space: pre-line; background-color: #f8fafc; padding: 12px; border-radius: 8px; margin-bottom: 10px; }
.vitalsRow { border: 1px dashed #cbd5e1; border-radius: 8px; padding: 10px; margin-bottom: 10px; background-color: #fefefe; }
.coordinate-box { background-color: #e2e8f0; border-radius: 8px; padding: 10px; margin-bottom: 10px; word-break: break-word; }
#map { width: 100%; height: 300px; border-radius: 12px; margin-bottom: 10px; }
.GPS-link a { display: block; text-align: center; padding: 10px; margin: 5px 0; background-color: #e0e7ff; border-radius: 8px; font-weight: bold; color: #1e40af; text-decoration: none; }
</style>
</head>

<body>
<div class="container">

<h1 class="text-2xl font-bold text-center text-blue-700 mb-4">ğŸš‘ ë¬´ë“±ì‚°ì‚°ì•…ì‚¬ê³  ëŒ€ì‘ ê¸°ë¡</h1>

<!-- ì„¤ëª… -->
<div class="section">
    <p>ë¬´ë“±ì‚° ì‚°ì•…ì‚¬ê³  ì¶œë™ ê¸°ë¡ìš©. íŠ¹ìˆ˜ì‚°ì•…êµ¬ì¡°íŒ€-ë¬´ë“±ì‚°</p>
    <p class="mt-2 text-sm text-gray-500">Â© 2024 Web Applications | Korea National Park Service Rescue Paramedic Lab</p>
</div>

<!-- í¼ ì‹œì‘ -->
<form id="recordForm">

<!-- ===== í˜„ì¥ ì •ë³´ ===== -->
<div class="section">
    <h2 class="text-xl font-semibold mb-2">í˜„ì¥ì •ë³´</h2>

    <label>ë„ì°©ì‹œê°„:
        <input type="datetime-local" name="ë°œìƒì‹œê°„" required>
    </label>

    <label>ì‚¬ê³ ì¥ì†Œ:
        <input type="text" name="ì¥ì†Œ" placeholder="ì˜ˆ: ë¬´ë“±ì‚° OOì¼ì›" required>
    </label>

    <label>ì‚¬ê³ ì¢Œí‘œ:
        <div class="coordinate-box" id="locationDisplay">ìœ„ë„: , ê²½ë„: </div>
        <button id="getLocation" type="button" class="bg-green-600 text-white px-3 py-1 rounded">
            ğŸŒ í˜„ì¥ë„ì°© ì¢Œí‘œ
        </button>
        <input type="hidden" name="ì‚¬ê³ ì¢Œí‘œ" id="hiddenCoordinate">
    </label>
<br>
    <br>
    <label>í™˜ìì¦ìƒ:
        <input type="text" name="ì£¼ì¦ìƒ" placeholder="ì˜ˆ: í˜¸í¡ê³¤ë€, ê°€ìŠ´ í†µì¦" required>
    </label>
</div>

<!-- ===== GCS ===== -->
<div class="section">
    <h2 class="text-xl font-semibold">ì˜ì‹í‰ê°€</h2>

    <label>ëˆˆ ëœ¨ê¸° ë°˜ì‘ (E)</label>
    <select id="eye">
        <option value=""></option>
        <option value="4">ìë°œì ìœ¼ë¡œ ëˆˆì„ ëœ¬ë‹¤</option>
        <option value="3">ë§ë¡œ ì§€ì‹œí–ˆì„ë•Œ ëˆˆì„ ëœ¬ë‹¤</option>
        <option value="2">í†µì¦ ìê·¹ì— ì˜í•´ ëˆˆì„ ëœ¬ë‹¤</option>
        <option value="1">ì–´ë– í•œ ìê·¹ì—ë„ ëˆˆì„ ëœ¨ì§€ ëª»í•œë‹¤</option>
    </select>

    <label>ì–¸ì–´ ë°˜ì‘ (V)</label>
    <select id="verbal">
        <option value=""></option>
        <option value="5">ì •í™•í•œ ë°˜ì‘(6í•˜ì›ì¹™ì— ì§€ë‚¨ë ¥ ìˆëŠ” ìƒíƒœ)</option>
        <option value="4">ëŒ€í™” í˜¼ë€(ëŒ€í™”ê°€ëŠ¥í•˜ë‚˜, ê³„ì†ì  ëŒ€í™” êµí™˜ ì•ˆë¨)</option>
        <option value="3">ì–¸ì–´í˜¼ë€(ë™ë¬¸ì„œë‹µ, í˜¼ë€ëœ ë§ì„ í•¨)</option>
        <option value="2">ì´í•´ í• ìˆ˜ ì—†ëŠ” ì†Œë¦¬(ì‹ ìŒì†Œë¦¬ë§Œ)</option>
        <option value="1">ë°˜ì‘ì´ ì—†ìŒ(ì•„ë¬´ëŸ° ì†Œë¦¬ë¥¼ ë‚´ì§€ ì•ŠìŒ)</option>
    </select>

    <label>ìš´ë™ ë°˜ì‘ (M)</label>
    <select id="motor">
        <option value=""></option>
        <option value="6">ëª…ë ¹ì— ë”°ë¦„(ê°„ë‹¨í•œ ëª…ë ¹ì— ë”°ë¼ ìš´ë™ê¸°ëŠ¥ ìˆ˜í–‰)</option>
        <option value="5">í†µì¦ ìê·¹ êµ­ì†Œí™” ë°˜ì‘(ëª…ë ¹ì€ ë”°ì§€ ì•Šì§€ë§Œ, ìê·¹ì„ ê°€í•˜ë©´ í”¼í•˜ê±°ë‚˜ ì¹˜ìš°ë ¤ê³  í•¨) </option>
        <option value="4">í†µì¦ ìê·¹ ì›€ì¸ ë¦¼(í†µì¦ ìê·¹ì„ í”¼í•˜ë ¤ê³  í•¨, ì¹˜ìš°ë ¤ê³  í•˜ì§€ëŠ” ì•ŠìŒ)</option>
        <option value="3">í†µì¦ ìê·¹ ì´ìƒêµ´ê³¡(í†µì¦ ìê·¹ì— ì•ìœ¼ë¡œ êµ¬ë¶€ë¦¬ê±°ë‚˜ ëª¸ìª½ìœ¼ë¡œ ì ‘ìŒ)</option>
        <option value="2">í†µì¦ ìê·¹ ì´ìƒì‹ ì „(í†µì¦ ìê·¹ì— ë’¤ë¡œ ì –íˆê±°ë‚˜ ëª¨ì—ì„œ ë©€ë¦¬ ë»—ìŒ)(</option>
        <option value="1">ì „í˜€ ì›€ì§ì´ì§€ ì•ŠìŒ(ë¬´ë°˜ì‘, ìê°€í˜¸í¡ ì—†ìŒ)</option>
    </select>

    <div id="gcsResultContainer" style="margin-top:10px; display:none;">
        <strong>ì˜ì‹í‰ê°€(GCS) ê²°ê³¼:</strong>
        <span id="gcsResult"></span>
    </div>
</div>

<!-- ===== í™˜ì ì •ë³´ ===== -->
<div class="section">
    <h2 class="text-xl font-semibold mb-2">í™˜ìì •ë³´</h2>

    <label>ì´ë¦„:
        <input type="text" name="í™˜ìì´ë¦„" required>
    </label>

    <label>ìƒë…„ì›”ì¼:
        <input type="date" name="ìƒë…„ì›”ì¼" required>
    </label>

    <label>ê±°ì£¼ì§€:
        <input type="text" name="ê±°ì£¼ì§€" required>
    </label>
</div>

<!-- ===== ì‘ê¸‰ì²˜ì¹˜ ===== -->
<div class="section">
    <h2 class="text-xl font-semibold mb-2">ì‘ê¸‰ì²˜ì¹˜</h2>
    <textarea name="ì‘ê¸‰ì²˜ì¹˜" rows="4" placeholder="SAMPLE, ì‹¤ì‹œí•œ ì‘ê¸‰ì²˜ì¹˜(ë¶€ëª©ê³ ì •, í™œë ¥ì§•í›„, ìƒì²˜ì¹˜, ì™¸ìƒí™˜ìí‰ê°€)  / ì£¼ì†Œ, ì¢Œí‘œ ìˆ˜ë™ì…ë ¥"></textarea>
</div>


<!-- ì œì¶œ ë²„íŠ¼ë“¤ -->
<button type="submit" class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg">ê¸°ë¡ ì €ì¥í•˜ê¸°</button>
<button type="button" onclick="sendToGoogleForm()" class="w-full bg-yellow-500 text-white py-3 px-4 rounded-lg mt-2">
    ğŸ“¤ ìƒí™©íŒìœ¼ë¡œ ì œì¶œí•˜ê¸°
</button>
<button type="button" onclick="shareReport()" class="w-full bg-purple-500 text-white py-3 px-4 rounded-lg mt-2">
    ê³µìœ 
</button>

<div id="resultMessage" class="mt-4 text-center"></div>
</form>

<!-- ===== ì‘ì„±ê¸°ë¡ ===== -->
<div class="section">
    <h2 class="text-xl font-semibold">ì‘ì„±ê¸°ë¡</h2>
    <div id="savedData" class="board"></div>
</div>

<!-- ===== GPS ì¢Œí‘œ ===== -->
<div class="section">
    <h2 class="text-xl font-semibold">GPS ì¢Œí‘œ</h2>

    <button id="getLocation2" class="bg-green-600 text-white px-3 py-1 rounded">ğŸŒ ë‚´ ìœ„ì¹˜ í™•ì¸</button>
    <button id="shareLocation" class="bg-blue-500 text-white px-3 py-1 rounded">ğŸ“² ìœ„ì¹˜ ê³µìœ </button>

    <div class="coordinate-box" id="locationDisplay2">ìœ„ë„: , ê²½ë„: </div>
    <div class="coordinate-box" id="dmsCoordinates">ë„ë¶„ì´ˆ: </div>

    <div id="map"></div>
</div>

<!-- ì™¸ë¶€ ë§í¬ -->
<div class="GPS-link">
  <a href="#" target="_blank">ì¡°ë‚œì ìœ„ì¹˜ê³µìœ  whereUrl</a>
</div>
<div class="GPS-link">
  <a href="https://discord.gg/ryaMRTAhwP" target="_blank">ğŸ¸ êµ­ë¦½ê³µì› ì•ˆì „ì‚¬ê³  ì—°êµ¬íšŒ</a>
</div>  

</div><!-- container end -->

<script>


/* ===== GCS ê³„ì‚° ===== */
function calculateGCS() {
    const e = parseInt(document.getElementById("eye").value);
    const v = parseInt(document.getElementById("verbal").value);
    const m = parseInt(document.getElementById("motor").value);

    const total = e + v + m;

    let state = '';
    if (total === 15) state = 'ì •ìƒ-alert';
    else if (total >= 13) state = 'ì¡¸ë¦¼-drowsy';
    else if (total >= 9) state = 'í˜¼ë¯¸-stupor';
    else if (total >= 4) state = 'ë°˜í˜¼ìˆ˜-semicoma';
    else state = 'í˜¼ìˆ˜-coma';

    document.getElementById("gcsResult").innerText = `${total}ì  (${state})`;
    document.getElementById("gcsResultContainer").style.display = "block";
}

["eye","verbal","motor"].forEach(id => {
    document.getElementById(id).addEventListener("change", calculateGCS);
});
calculateGCS();

/* ===== ê¸°ë¡ ì €ì¥ + êµ¬ê¸€ì‹œíŠ¸ ì €ì¥ ===== */
document.getElementById("recordForm").addEventListener("submit", async function(e){
    e.preventDefault();

    const form = new FormData(e.target);
    const data = {};

    data["GCS"] = document.getElementById("gcsResult").innerText;

    form.forEach((v,k)=> data[k]=v);

    /* TXT íŒŒì¼ ì €ì¥ */
    let textContent = "";
    for (let key in data){
        textContent += `${key}: ${data[key]}\n`;
    }

    const today = new Date().toISOString().slice(0,10);
    const blob = new Blob([textContent],{type:"text/plain"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");

    a.href = url;
    a.download = `ë¬´ë“±ì‚° íŠ¹ìˆ˜ì‚°ì•…êµ¬ì¡°íŒ€_í™˜ìí‰ê°€_${today}.txt`;
    a.click();

    URL.revokeObjectURL(url);

    document.getElementById("savedData").innerHTML =
        `<div class="board-item">${textContent}</div>`;
    document.getElementById("resultMessage").innerText = "ê¸°ë¡ ì €ì¥ ì™„ë£Œ âœ…";

    /* êµ¬ê¸€ì‹œíŠ¸ ì €ì¥ */
    try {
        const scriptURL = "https://script.google.com/macros/s/AKfycbxm_oLeGMIGh5PRokCURztVx6-1Ijug2KtuGbsFH-cZVOKE5LgaKDnLbTgFl2sWWDdkwA/exec";

        await fetch(scriptURL, {
            method: "POST",
            body: JSON.stringify(data)
        });

    } catch(err){
        console.log("êµ¬ê¸€ì‹œíŠ¸ ì˜¤ë¥˜:", err);
    }
});

/* ===== êµ¬ê¸€ í¼ ì œì¶œ ===== */
function sendToGoogleForm() {
    alert("êµ¬ê¸€í¼ ê¸°ëŠ¥ì´ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.");
}

/* ===== GPS ê¸°ëŠ¥ ===== */
let currentLat, currentLng;

document.getElementById("getLocation").addEventListener("click", function(){
    navigator.geolocation.getCurrentPosition(showPos, showErr);
});

document.getElementById("getLocation2").addEventListener("click", function(){
    navigator.geolocation.getCurrentPosition(showPos, showErr);
});

function showPos(position){
    currentLat = position.coords.latitude;
    currentLng = position.coords.longitude;

    const t = `ìœ„ë„: ${currentLat}, ê²½ë„: ${currentLng}`;

    document.getElementById("locationDisplay").textContent = t;
    document.getElementById("locationDisplay2").textContent = t;
    document.getElementById("hiddenCoordinate").value = t;

    initMap(currentLat, currentLng);
}

function showErr(e){
    alert("GPS ì˜¤ë¥˜ ë°œìƒ");
}

function initMap(lat, lng){
    const map = new kakao.maps.Map(document.getElementById("map"), {
        center: new kakao.maps.LatLng(lat, lng),
        level: 3
    });

    new kakao.maps.Marker({
        position: new kakao.maps.LatLng(lat, lng),
        map: map
    });
}

/* ===== ê³µìœ  ===== */
function shareReport(){
    const form = new FormData(document.getElementById("recordForm"));
    let text = "";

    form.forEach((v,k)=> text += `${k}: ${v}\n`);
    text += "GCS: " + document.getElementById("gcsResult").innerText;

    if (navigator.share){
        navigator.share({title:"ë¬´ë“±ì‚° íŠ¹ìˆ˜ì‚°ì•…êµ¬ì¡°íŒ€ í™˜ìí‰ê°€", text});
    } else {
        alert("ê³µìœ  ê¸°ëŠ¥ ë¯¸ì§€ì›");
    }
}

</script>

</body>
</html>

