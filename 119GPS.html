<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ğŸ†˜ êµ¬ì¡°ìš”ì²­</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ì¹´ì¹´ì˜¤ ì§€ë„ API -->
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=ff9e145029506d6e4c72d1f2b01ea424&libraries=services"></script>

<style>
body {
    margin:0;
    font-family: Arial, sans-serif;
    background:#f5f5f5;
}
header {
    background:#b71c1c;
    color:white;
    padding:14px;
    text-align:center;
    font-size:20px;
}
#map {
    width:100%;
    height:300px;
}
section {
    padding:15px;
}
.info {
    background:white;
    padding:12px;
    border-radius:6px;
    margin-bottom:10px;
}
input, textarea, button {
    width:100%;
    padding:10px;
    margin-top:8px;
    font-size:16px;
}
textarea { resize:vertical; }
button {
    background:#d32f2f;
    color:white;
    border:none;
    border-radius:6px;
    cursor:pointer;
    font-size:18px;
}
.small {
    font-size:14px;
    color:#555;
}
</style>
</head>
<body>

<header>ğŸ†˜ êµ¬ì¡°ìš”ì²­</header>

<div id="map"></div>

<section>
    <div class="info" id="gpsInfo">ğŸ“ ìœ„ì¹˜ í™•ì¸ ì¤‘...</div>

    <div class="info">
        <b>ğŸ‘¤ êµ¬ì¡°ìš”ì²­ì‚¬í•­</b>

        <textarea id="condition" placeholder="ì¦ìƒ ë° ìƒí™© (ì˜ˆ: ë‚´ìœ„ì¹˜ ë“±)"></textarea>
    </div>

    <button onclick="sendSMSAndCall()">âœ‰ï¸ ì‚°ì•…êµ¬ì¡°ëŒ€ì „ì†¡ </button>
    <div class="small">
        â€» ë¬¸ì ë° ì „í™”ëŠ” <b>ë¬´ë“±ì‚°íŠ¹ìˆ˜ì‚°ì•…êµ¬ì¡°ëŒ€</b>ë¡œ ì—°ê²°ë©ë‹ˆë‹¤
    </div>
</section>

<script>
let map, marker;
let lat = null, lng = null;

// ğŸš‘ êµ¬ì¡°ëŒ€ ê³ ì • ë²ˆí˜¸
const RESCUE_NUMBER = "01080020860";

// âœ… êµ¬ê¸€ì‹œíŠ¸ Apps Script ì›¹ì•± URL (ë°˜ë“œì‹œ êµì²´!)
const GOOGLE_SHEET_API =
  "https://script.google.com/macros/s/AKfycbyTOMmbvCIDZ5VpxWQS5hdjdXdwcvoYsva-Ljtd2Y81lBfuSsPJ-jYhdMPhhxz31jHCaQ/exec";
   
// ì§€ë„ ì´ˆê¸°í™”
function initMap(latInit = 37.5665, lngInit = 126.9780) {
    map = new kakao.maps.Map(document.getElementById("map"), {
        center: new kakao.maps.LatLng(latInit, lngInit),
        level: 3
    });
    marker = new kakao.maps.Marker({ map: map });
}
initMap();

// ì‹¤ì‹œê°„ GPS
navigator.geolocation.watchPosition(
    pos => {
        lat = pos.coords.latitude;
        lng = pos.coords.longitude;

        const loc = new kakao.maps.LatLng(lat, lng);
        map.setCenter(loc);
        marker.setPosition(loc);

        document.getElementById("gpsInfo").innerHTML = `
            ğŸ“ ìœ„ë„: ${lat.toFixed(6)}<br>
            ğŸ“ ê²½ë„: ${lng.toFixed(6)}
        `;
    },
    () => alert("ìœ„ì¹˜ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤."),
    { enableHighAccuracy:true, maximumAge:0, timeout:5000 }
);

// ë¬¸ì + êµ¬ê¸€ì‹œíŠ¸ + ì „í™”
function sendSMSAndCall() {
    if (lat === null || lng === null) {
        alert("ìœ„ì¹˜ í™•ì¸ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.");
        return;
    }

    const name = document.getElementById("name").value || "ë¯¸ìƒ";
    const age = document.getElementById("age").value || "-";
    const contact = document.getElementById("contact").value || "-";
    const condition = document.getElementById("condition").value || "-";

    const payload = {
        lat: lat.toFixed(6),
        lng: lng.toFixed(6),
        name,
        age,
        contact,
        condition
    };

    // 1ï¸âƒ£ êµ¬ê¸€ì‹œíŠ¸ ìë™ ì €ì¥
    fetch(GOOGLE_SHEET_API, {
        method: "POST",
        body: JSON.stringify(payload)
    }).catch(err => console.error("ì‹œíŠ¸ ì €ì¥ ì‹¤íŒ¨", err));

    const message =
`[êµ¬ì¡°ìš”ì²­]
ìœ„ë„: ${payload.lat}
ê²½ë„: ${payload.lng}
ì¦ìƒ: ${condition}`;

    // 2ï¸âƒ£ ë¬¸ì ì „ì†¡
    location.href =
        `sms:${RESCUE_NUMBER}?body=${encodeURIComponent(message)}`;

    // 3ï¸âƒ£ ì „í™” ì—°ê²°
    setTimeout(() => {
        location.href = `tel:${RESCUE_NUMBER}`;
    }, 1200);
}
</script>

</body>
</html>
