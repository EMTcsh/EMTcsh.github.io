<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>무등산 산불관리 시스템</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      background-color: #f3f4f6;
    }
    #map {
      height: 100%;
      width: 100%;
      border-radius: 0.5rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .info-panel {
      max-height: 100%;
      overflow-y: auto;
    }
  </style>
</head>
<body class="bg-gray-100">

  <div class="p-4 sm:p-8">
    <header class="text-center">
      <h1 class="text-3xl sm:text-4xl font-extrabold text-gray-800 tracking-tight">무등산 산불관리 시스템</h1>
      <p class="mt-2 text-lg text-gray-600">위성 지도를 통해 산불 위험 지역을 모니터링하고 관리합니다.</p>
    </header>
  </div>

  <main class="flex flex-col lg:flex-row p-4 sm:p-8 pt-0 gap-8 overflow-hidden fixed-container">
    <div id="map-container" class="relative w-full h-screen">
      <div id="map" class="w-full h-full"></div>

      <div class="absolute top-4 right-4 w-72 bg-white p-6 rounded-xl shadow-lg space-y-6">
        <h3>무등산국립공원 산불관리 현황</h3>
        <p>총 탐방로: 38구간 99.4km</p>
        <p>개방 탐방로: 35구간 95.5km</p>
        <p>통제 탐방로: 3구간 3.9km</p>
        <p>감시초소 1개 / 통제소 3개 / 인화물질보관함 8개</p>
      </div>
    </div>

    <div class="w-1/6 bg-white p-6 rounded-xl shadow-lg space-y-6 flex-shrink-0">
      <div class="space-y-4">
        <h2 class="text-2xl font-bold text-gray-800">지도 제어</h2>
        <div>
          <input type="text" id="latInput" placeholder="위도 (예: 35.1)" class="w-full px-3 py-2 border rounded-md"/>
          <input type="text" id="lngInput" placeholder="경도 (예: 126.9)" class="w-full mt-2 px-3 py-2 border rounded-md"/>
          <button id="addByCoordBtn" class="w-full mt-2 bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md">
            좌표로 위험 지역 표시
          </button>
        </div>

        <hr class="border-gray-200"/>

        <button id="addPointBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md">
          지도에서 클릭하여 표시
        </button>
        <button id="toggleMapTypeBtn" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md">
          지도/위성 전환
        </button>
      </div>

      <hr class="border-gray-200"/>

      <div class="space-y-4">
        <h3 class="text-2xl font-bold text-gray-800">산불 발생 정보</h3>
        <div id="infoPanel" class="info-panel bg-gray-50 p-4 rounded-lg border border-gray-200 text-gray-700">
          마커를 클릭하여 상세 정보를 확인하세요.
        </div>
      </div>
    </div>
  </main>

  <!-- Naver Map API -->
  <script src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=g2u4orbiqf"></script>
  <script>
    const landslideData = [
      {
        lat: 35.1285782,
        lng: 126.9699028,
        risk: "국립공원구역",
        date: "2024-09-29",
        description: "과거 산불 발생 지역 (증심사 인근)"
      }
    ];

    let map;
    let markers = [];
    let isSatellite = false;
    let isAddingPoint = false;

    function initMap() {
      map = new naver.maps.Map("map", {
        center: new naver.maps.LatLng(35.119158, 127.003814),
        zoom: 13,
        zoomControl: true,
        mapTypeControl: true
      });

      renderMarkers();

      naver.maps.Event.addListener(map, "click", function (e) {
        if (isAddingPoint) {
          const newLat = e.coord.y;
          const newLng = e.coord.x;

          const newPoint = {
            lat: newLat,
            lng: newLng,
            risk: "국립공원구역",
            date: new Date().toISOString().slice(0, 10),
            description: "지도 클릭으로 추가된 위험 지역"
          };

          landslideData.push(newPoint);
          renderMarkers();

          isAddingPoint = false;
          document.getElementById("addPointBtn").textContent = "지도에서 클릭하여 표시";
          document.getElementById("addPointBtn").classList.remove("bg-red-500", "hover:bg-red-600");
          document.getElementById("addPointBtn").classList.add("bg-blue-600", "hover:bg-blue-700");
          document.getElementById("infoPanel").innerHTML = "새로운 위험 지점이 추가되었습니다.";
        }
      });
    }

    function renderMarkers() {
      markers.forEach(marker => marker.setMap(null));
      markers = [];

      landslideData.forEach(data => {
        const marker = new naver.maps.Marker({
          position: new naver.maps.LatLng(data.lat, data.lng),
          map: map,
          title: data.description,
          icon: getMarkerIcon(data.risk)
        });

        naver.maps.Event.addListener(marker, "click", () => {
          document.getElementById("infoPanel").innerHTML = `
            <h3 class="text-xl font-semibold">${data.date}</h3>
            <p class="mt-2"><strong>위험도:</strong> ${data.risk}</p>
            <p><strong>위치:</strong> ${data.lat.toFixed(6)}, ${data.lng.toFixed(6)}</p>
            <p><strong>설명:</strong> ${data.description}</p>
          `;
        });

        markers.push(marker);
      });
    }

    function getMarkerIcon(risk) {
      let iconUrl = "";

      switch (risk) {
        case "국립공원구역":
          iconUrl = "https://cdn-icons-png.flaticon.com/512/483/483947.png"; // 빨간 불꽃
          break;
        case "국립공원인접":
          iconUrl = "https://cdn-icons-png.flaticon.com/512/616/616408.png"; // 주황 불꽃
          break;
        case "국립공원밖":
          iconUrl = "https://cdn-icons-png.flaticon.com/512/616/616554.png"; // 노란 불꽃
          break;
        default:
          iconUrl = "https://cdn-icons-png.flaticon.com/512/149/149059.png"; // 기본 마커
      }

      return {
        url: iconUrl,
        size: new naver.maps.Size(32, 32),
        origin: new naver.maps.Point(0, 0),
        anchor: new naver.maps.Point(16, 32)
      };
    }

    document.getElementById("addPointBtn").addEventListener("click", () => {
      isAddingPoint = true;
      document.getElementById("addPointBtn").textContent = "지도에서 위치를 클릭하세요...";
      document.getElementById("addPointBtn").classList.remove("bg-blue-600", "hover:bg-blue-700");
      document.getElementById("addPointBtn").classList.add("bg-red-500", "hover:bg-red-600");
      document.getElementById("infoPanel").innerHTML = "<strong class='text-red-500'>지도 클릭 모드 활성화됨.</strong>";
    });

    document.getElementById("addByCoordBtn").addEventListener("click", () => {
      const lat = parseFloat(document.getElementById("latInput").value);
      const lng = parseFloat(document.getElementById("lngInput").value);

      if (isNaN(lat) || isNaN(lng)) {
        document.getElementById("infoPanel").innerHTML = "<strong class='text-red-500'>오류:</strong> 올바른 위도와 경도 값을 입력하세요.";
        return;
      }

      const newPoint = {
        lat: lat,
        lng: lng,
        risk: "국립공원구역",
        date: new Date().toISOString().slice(0, 10),
        description: "좌표 입력으로 추가된 위험 지역"
      };

      landslideData.push(newPoint);
      renderMarkers();

      document.getElementById("infoPanel").innerHTML = "위험 지점이 좌표로 추가되었습니다.";
      document.getElementById("latInput").value = "";
      document.getElementById("lngInput").value = "";
    });

    document.getElementById("toggleMapTypeBtn").addEventListener("click", () => {
      isSatellite = !isSatellite;
      map.setMapTypeId(isSatellite ? naver.maps.MapTypeId.SATELLITE : naver.maps.MapTypeId.NORMAL);
    });

    window.addEventListener("DOMContentLoaded", initMap);
  </script>
</body>
</html>

