<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ğŸ†˜ ì‚°ì•…ì‚¬ê³  êµ¬ì¡°ìš”ì²­</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=ff9e145029506d6e4c72d1f2b01ea424&libraries=services"></script>

<style>
body { margin:0; font-family: Arial, sans-serif; background:#f5f5f5; }
header { background:#b71c1c; color:white; padding:14px; text-align:center; font-size:20px; }
#map { width:100%; height:450px; }

section { padding:15px; }
button {
  width:90%; padding:14px; font-size:18px;
  background:#d32f2f; color:white;
  border:none; border-radius:6px;
}

.info { background:white; padding:12px; border-radius:6px; margin-bottom:10px; }
.small { font-size:14px; color:#555; padding:0 15px; }

/* ìœ„ì¹˜ì •ë³´ ì•ˆë‚´ í† ê¸€ */
.consent-box { padding:0 15px; margin-top:10px; }
.consent-title {
  font-size:14px;
  font-weight:bold;
  background:#f2f2f2;
  padding:10px;
  border-radius:6px;
  cursor:pointer;
}
.consent-detail {
  display:none;
  font-size:13px;
  margin-top:8px;
  padding:10px;
  background:#fafafa;
  border-radius:6px;
  line-height:1.6;
}
</style>

<script>
function toggleConsent() {
  const d = document.getElementById("consentDetail");
  d.style.display = (d.style.display === "none" || d.style.display === "")
    ? "block" : "none";
}
</script>
</head>

<body>

<header>ğŸ†˜ ë¬´ë“±ì‚° ì‚°ì•…êµ¬ì¡° ìš”ì²­</header>

<!-- ìœ„ì¹˜ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ì•ˆë‚´ (í† ê¸€) -->
<div class="consent-box">
  <div class="consent-title" onclick="toggleConsent()">
    êµ¬ì¡°ìš”ì²­ ìœ„ì¹˜ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ì•ˆë‚´ (ìì„¸íˆ ë³´ê¸°)
  </div>
  <div class="consent-detail" id="consentDetail">
    ì‚°ì•…ì‚¬ê³  ë“± ê¸´ê¸‰ ìƒí™© ë°œìƒ ì‹œ êµ¬ì¡°Â·êµ¬ê¸‰ ìš”ì²­ì„ ëª©ì ìœ¼ë¡œ ìš´ì˜ë©ë‹ˆë‹¤.<br>
    êµ¬ì¡° ìš”ì²­ ê³¼ì •ì—ì„œ <b>GPS ìœ„ì¹˜ì •ë³´, íœ´ëŒ€ì „í™” ë²ˆí˜¸, êµ¬ì¡°ìš”ì²­ ì‹œê°„</b>ì„ ìˆ˜ì§‘í•˜ë©°,<br>
    ìˆ˜ì§‘ëœ ì •ë³´ëŠ” <b>ì‹ ì†í•œ êµ¬ì¡°Â·êµ¬ê¸‰ í™œë™ ìˆ˜í–‰ì„ ìœ„í•œ ìš©ë„ì— í•œí•˜ì—¬ ì‚¬ìš©</b>ë©ë‹ˆë‹¤.<br>
    í•´ë‹¹ ì •ë³´ëŠ” êµ¬ì¡°Â·êµ¬ê¸‰ ëª©ì  ì™¸ ë‹¤ë¥¸ ìš©ë„ë¡œëŠ” ì‚¬ìš©ë˜ì§€ ì•Šìœ¼ë©°,<br>
    ê´€ë ¨ ë²•ë ¹ì— ë”°ë¼ ì ì ˆí•œ ë³´ì•ˆ ì¡°ì¹˜ë¥¼ í†µí•´ ê´€ë¦¬ë©ë‹ˆë‹¤.<br><br>
    <b>[ë¬¸ì ì „ì†¡]</b> ë²„íŠ¼ì„ ì„ íƒí•  ê²½ìš° ìœ„ ìœ„ì¹˜ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ë™ì˜í•œ ê²ƒìœ¼ë¡œ ê°„ì£¼ë©ë‹ˆë‹¤.
  </div>
</div>

<section class="info">
  <div id="gpsInfo">ğŸ“ í˜„ì¬ ìœ„ì¹˜ í™•ì¸ ì¤‘...</div>
  <br>
  <br>
  <button onclick="sendSMSAndCall()">âœ‰ï¸ ì‚°ì•…êµ¬ì¡°ëŒ€ì—ê²Œ ë¬¸ìì „ì†¡</button>
</section>

<div class="small">
â€» ìƒëª… ë³´í˜¸ë¥¼ ìœ„í•œ êµ¬ì¡°Â·êµ¬ê¸‰ ëª©ì ì˜ ìœ„ì¹˜ì •ë³´ ì œê³µ<br>
  ë¬¸ìì „ì†¡ì€ <b>ë¬´ë“±ì‚° íŠ¹ìˆ˜ì‚°ì•…êµ¬ì¡°ëŒ€</b>ë¡œ ì—°ê²°ë©ë‹ˆë‹¤
</div>

<br>
<div id="map"></div>

<script>
let map, userMarker;
let currentLat = null, currentLng = null;

const RESCUE_NUMBER = "01066650113";
const GOOGLE_SHEET_API =
  "https://script.google.com/macros/s/AKfycbwR_WOHslJnvmdI9K0Vckgr1k6_ZPJVdgF6ynwxVxXJ1qlzHw9nxc3HPVM8mn_qp7k/exec";

// ì§€ë„ ì´ˆê¸°í™”
function initMap(lat = 35.131295, lng = 126.948047) {
  map = new kakao.maps.Map(document.getElementById("map"), {
    center: new kakao.maps.LatLng(lat, lng),
    level: 3
  });
  userMarker = new kakao.maps.Marker({ map });
}
initMap();

// GPS ì¶”ì 
if (navigator.geolocation) {
  navigator.geolocation.watchPosition(
    pos => {
      currentLat = pos.coords.latitude;
      currentLng = pos.coords.longitude;

      const lat = currentLat.toFixed(6);
      const lng = currentLng.toFixed(6);

      const loc = new kakao.maps.LatLng(lat, lng);
      map.setCenter(loc);
      userMarker.setPosition(loc);

      document.getElementById("gpsInfo").innerHTML = `
        ğŸ“ <b>í˜„ì¬ ìœ„ì¹˜</b><br>
        ìœ„ë„: ${lat}<br>
        ê²½ë„: ${lng}
      `;
    },
    () => {
      document.getElementById("gpsInfo").innerHTML =
        "ğŸ“ ìœ„ì¹˜ í™•ì¸ ì‹¤íŒ¨: ìœ„ì¹˜ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.";
    },
    { enableHighAccuracy:true }
  );
}

// ë¬¸ì ì „ì†¡ + ì‹œíŠ¸ ì €ì¥
function sendSMSAndCall() {
  if (!currentLat || !currentLng) {
    alert("í˜„ì¬ ìœ„ì¹˜ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }

  const lat = currentLat.toFixed(6);
  const lng = currentLng.toFixed(6);
  const kakaoMapURL = `https://map.kakao.com/link/map/${lat},${lng}`;

  fetch(GOOGLE_SHEET_API, {
    method: "POST",
    body: JSON.stringify({
      lat: Number(lat),
      lng: Number(lng),
      kakaoMapURL,
      condition: "-"
    })
  });

  const smsText = `
ğŸš¨ [ì‚°ì•…êµ¬ì¡°ìš”ì²­]
ğŸ“ ìœ„ë„: ${lat}
ğŸ“ ê²½ë„: ${lng}
ğŸ—º ì¹´ì¹´ì˜¤ë§µ: ${kakaoMapURL}
`;

  if (/Mobi|Android/i.test(navigator.userAgent)) {
    location.href =
      `sms:${RESCUE_NUMBER}?body=${encodeURIComponent(smsText)}`;
  } else {
    alert("ëª¨ë°”ì¼ì—ì„œë§Œ ë¬¸ì ì „ì†¡ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.\n\n" + smsText);
  }
}
</script>

</body>
</html>
