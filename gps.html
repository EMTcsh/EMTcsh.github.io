<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ğŸ†˜ ì‚°ì•…ì‚¬ê³  êµ¬ì¡°ìš”ì²­</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=ff9e145029506d6e4c72d1f2b01ea424&libraries=services"></script>

<style>
body { margin:0; font-family: Arial, sans-serif; background:#f5f5f5; }
header { background:#b71c1c; color:white; padding:14px; text-align:center; font-size:20px; }
#map { width:100%; height:450px; }
section { padding:15px; }
button {
  width:90%; padding:14px; font-size:18px;
  background:#d32f2f; color:white;
  border:none; border-radius:6px;
}
.info { background:white; padding:12px; border-radius:6px; margin-bottom:10px; }
.small { font-size:14px; color:#555; padding:0 15px; }
a.maplink { color:#d32f2f; font-weight:bold; text-decoration:none; }
</style>
</head>

<body>

<header>ğŸ†˜ ë¬´ë“±ì‚° ì‚°ì•…êµ¬ì¡° ìš”ì²­</header>

<section class="info">
  <div id="gpsInfo">ğŸ“ í˜„ì¬ ìœ„ì¹˜ í™•ì¸ ì¤‘...</div>
  <button onclick="sendSMSAndCall()">âœ‰ï¸ ì‚°ì•…êµ¬ì¡°ëŒ€ ë¬¸ìì „ì†¡</button>
</section>

<div class="small">
<b>ğŸ“ ìœ„ì¹˜ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ì•ˆë‚´</b><br>
GPS ìœ„ì¹˜ì •ë³´ì™€ ìš”ì²­ ì‹œê°ì€ êµ¬ì¡°Â·êµ¬ê¸‰ ëª©ì ì—ë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤.<br>
<b>[ë¬¸ì ì „ì†¡]</b>ì„ ëˆ„ë¥´ë©´ ë™ì˜í•œ ê²ƒìœ¼ë¡œ ê°„ì£¼ë©ë‹ˆë‹¤.
</div>

<div class="small">
â€» ë¬¸ìì „ì†¡ì€ <b>ë¬´ë“±ì‚° íŠ¹ìˆ˜ì‚°ì•…êµ¬ì¡°ëŒ€</b>ë¡œ ì—°ê²°ë©ë‹ˆë‹¤
</div>

<br>
<div id="map"></div>

<script>
let map, userMarker;
let currentLat = null, currentLng = null;

const RESCUE_NUMBER = "01066650113";
const GOOGLE_SHEET_API =
  "https://script.google.com/macros/s/AKfycbwR_WOHslJnvmdI9K0Vckgr1k6_ZPJVdgF6ynwxVxXJ1qlzHw9nxc3HPVM8mn_qp7k/exec";

// ì§€ë„ ì´ˆê¸°í™”
function initMap(lat = 35.131295, lng = 126.948047) {
  map = new kakao.maps.Map(document.getElementById("map"), {
    center: new kakao.maps.LatLng(lat, lng),
    level: 3
  });
  userMarker = new kakao.maps.Marker({ map });
}
initMap();

// GPS ì¶”ì 
if (navigator.geolocation) {
  navigator.geolocation.watchPosition(
    pos => {
      currentLat = pos.coords.latitude;
      currentLng = pos.coords.longitude;

      const lat = currentLat.toFixed(6);
      const lng = currentLng.toFixed(6);
      const kakaoMapURL = `https://map.kakao.com/link/map/${lat},${lng}`;

      const loc = new kakao.maps.LatLng(lat, lng);
      map.setCenter(loc);
      userMarker.setPosition(loc);

      document.getElementById("gpsInfo").innerHTML = `
        ğŸ“ <b>í˜„ì¬ ìœ„ì¹˜</b><br>
        ìœ„ë„: ${lat}<br>
        ê²½ë„: ${lng}<br><br>
      `;
    },
    () => {
      document.getElementById("gpsInfo").innerHTML =
        "ğŸ“ ìœ„ì¹˜ í™•ì¸ ì‹¤íŒ¨: ìœ„ì¹˜ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.";
    },
    { enableHighAccuracy:true }
  );
}

// ë¬¸ì ì „ì†¡ + ì‹œíŠ¸ ì €ì¥
function sendSMSAndCall() {
  if (!currentLat || !currentLng) {
    alert("í˜„ì¬ ìœ„ì¹˜ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }

  const lat = currentLat.toFixed(6);
  const lng = currentLng.toFixed(6);
  const kakaoMapURL = `https://map.kakao.com/link/map/${lat},${lng}`;

  // ğŸ”¹ GASì™€ ì™„ì „ ì¼ì¹˜ payload
  fetch(GOOGLE_SHEET_API, {
    method: "POST",
    body: JSON.stringify({
      lat: Number(lat),
      lng: Number(lng),
      kakaoMapURL: kakaoMapURL,
      condition: "-"   // ì…ë ¥ì°½ ì œê±° ëŒ€ì‘
    })
  });

  const smsText = `
ğŸš¨ [ì‚°ì•…êµ¬ì¡°ìš”ì²­]
ğŸ“ ìœ„ë„: ${lat}
ğŸ“ ê²½ë„: ${lng}
ğŸ—º ì¹´ì¹´ì˜¤ë§µ: ${kakaoMapURL}
`;

  if (/Mobi|Android/i.test(navigator.userAgent)) {
    location.href =
      `sms:${RESCUE_NUMBER}?body=${encodeURIComponent(smsText)}`;
  } else {
    alert("ëª¨ë°”ì¼ì—ì„œë§Œ ë¬¸ì ì „ì†¡ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.\n\n" + smsText);
  }
}
</script>

</body>
</html>
