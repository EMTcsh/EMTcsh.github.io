<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>응급구조사 구급활동일지</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @media print {
      .no-print { display: none !important; }
      body { background: white; }
    }
    .field-label { min-width: 5rem; font-weight: bold; }
  </style>
</head>
<body class="bg-gray-100 p-4">
  <div class="max-w-4xl mx-auto bg-white shadow-lg rounded-xl p-6 space-y-6">

    <h1 class="text-2xl font-bold text-center mb-4">🚑 구급활동일지</h1>

    <!-- 환자정보 -->
    <section>
      <h2 class="text-xl font-semibold mb-2">환자 정보</h2>
      <div class="grid grid-cols-2 gap-4">
        <input type="text" placeholder="성명" class="border p-2 rounded w-full" id="p_name">
        <input type="text" placeholder="성별" class="border p-2 rounded w-full" id="p_gender">
        <input type="text" placeholder="연령" class="border p-2 rounded w-full" id="p_age">
        <input type="text" placeholder="연락처" class="border p-2 rounded w-full" id="p_phone">
      </div>
    </section>

    <!-- 활력징후 -->
    <section>
      <h2 class="text-xl font-semibold mb-2">활력징후</h2>
      <div id="vitalContainer" class="space-y-2">
        <div class="grid grid-cols-6 gap-2">
          <input type="text" placeholder="혈압" class="border p-2 rounded v_bp">
          <input type="text" placeholder="맥박" class="border p-2 rounded v_hr">
          <input type="text" placeholder="호흡수" class="border p-2 rounded v_rr">
          <input type="text" placeholder="SpO₂" class="border p-2 rounded v_spO2">
          <input type="text" placeholder="GCS" class="border p-2 rounded v_gcs">
          <input type="text" placeholder="혈당" class="border p-2 rounded v_bloodSugar">
        </div>
      </div>
      <button onclick="addVital()" class="mt-2 bg-blue-500 text-white px-3 py-1 rounded">+ 추가</button>
    </section>

    <!-- 처치·장비 -->
    <section>
      <h2 class="text-xl font-semibold mb-2">처치·장비</h2>
      <div id="treatmentContainer" class="space-y-2">
        <div class="grid grid-cols-3 gap-2">
          <input type="text" placeholder="처치내용" class="border p-2 rounded treatment">
          <input type="text" placeholder="사용장비" class="border p-2 rounded equipment">
          <input type="text" placeholder="비고" class="border p-2 rounded note">
        </div>
      </div>
      <button onclick="addTreatment()" class="mt-2 bg-green-500 text-white px-3 py-1 rounded">+ 추가</button>
    </section>

    <!-- 버튼 -->
    <div class="flex justify-center space-x-4 no-print">
      <button onclick="saveData()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg shadow">저장/전송</button>
      <button onclick="window.print()" class="bg-gray-500 text-white px-4 py-2 rounded-lg shadow">출력</button>
    </div>
  </div>

  <script>
    // 활력징후 추가
    function addVital() {
      const div = document.createElement("div");
      div.className = "grid grid-cols-6 gap-2";
      div.innerHTML = `
        <input type="text" placeholder="혈압" class="border p-2 rounded v_bp">
        <input type="text" placeholder="맥박" class="border p-2 rounded v_hr">
        <input type="text" placeholder="호흡수" class="border p-2 rounded v_rr">
        <input type="text" placeholder="SpO₂" class="border p-2 rounded v_spO2">
        <input type="text" placeholder="GCS" class="border p-2 rounded v_gcs">
        <input type="text" placeholder="혈당" class="border p-2 rounded v_bloodSugar">
      `;
      document.getElementById("vitalContainer").appendChild(div);
    }

    // 처치/장비 추가
    function addTreatment() {
      const div = document.createElement("div");
      div.className = "grid grid-cols-3 gap-2";
      div.innerHTML = `
        <input type="text" placeholder="처치내용" class="border p-2 rounded treatment">
        <input type="text" placeholder="사용장비" class="border p-2 rounded equipment">
        <input type="text" placeholder="비고" class="border p-2 rounded note">
      `;
      document.getElementById("treatmentContainer").appendChild(div);
    }

    // 데이터 저장 (Google Sheets로 전송)
    function saveData() {
      const data = {
        patient: {
          name: document.getElementById("p_name").value,
          gender: document.getElementById("p_gender").value,
          age: document.getElementById("p_age").value,
          phone: document.getElementById("p_phone").value,
        },
        vitals: [],
        treatments: []
      };

      document.querySelectorAll("#vitalContainer > div").forEach(row => {
        data.vitals.push({
          bp: row.querySelector(".v_bp").value,
          hr: row.querySelector(".v_hr").value,
          rr: row.querySelector(".v_rr").value,
          spO2: row.querySelector(".v_spO2").value,
          gcs: row.querySelector(".v_gcs").value,
          bloodSugar: row.querySelector(".v_bloodSugar").value,
        });
      });

      document.querySelectorAll("#treatmentContainer > div").forEach(row => {
        data.treatments.push({
          treatment: row.querySelector(".treatment").value,
          equipment: row.querySelector(".equipment").value,
          note: row.querySelector(".note").value,
        });
      });

      const url = "https://script.google.com/macros/s/AKfycbwoukv-YGDe0zapkyipf9oSObecU8bJr4JAyHregzOyWb-mp9rQTioTbtCpTmY4MhyYZQ/exec"; // 🔹 Apps Script 배포 URL 넣기

      fetch(url, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      })
      .then(() => alert("전송 완료!"))
      .catch(err => alert("전송 실패: " + err));
    }
  </script>
</body>
</html>

