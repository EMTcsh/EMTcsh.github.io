<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PARAMEDIC ì‘ê¸‰í™˜ì í‰ê°€ë„êµ¬</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { font-family: Arial, sans-serif; padding: 10px; }
  .section { margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 8px; background: #f9f9f9; }
  .board-item { border-bottom: 1px solid #ddd; padding: 10px 0; white-space: pre-line; }
  .discord-link { border: 1px solid #ddd; border-radius: 5px; padding: 10px; margin: 10px 0; text-align: center; background-color: #f4f4f4; }
  a { text-decoration: none; color: #7289DA; font-weight: bold; }
  .vitalsRow { border: 1px dashed #ccc; padding: 5px; margin-bottom: 10px; border-radius: 5px; background-color: #fff; }
</style>
</head>
<body>

<h1 class="text-2xl font-bold mb-4">ğŸš‘ PARAMEDIC ì‘ê¸‰í™˜ì í‰ê°€ë„êµ¬</h1>

<form id="recordForm">
  <!-- í™˜ì ì •ë³´ -->
  <div class="section">
    <h2 class="text-xl font-semibold mb-2">í™˜ì ì •ë³´</h2>
    <label>ì´ë¦„: <input type="text" name="í™˜ìì´ë¦„" required class="rounded-lg"></label><br>
    <label>ìƒë…„ì›”ì¼: <input type="date" name="ìƒë…„ì›”ì¼" required class="rounded-lg"></label>
  </div>

  <!-- í™œë ¥ì§•í›„ -->
  <div class="section">
    <h2 class="text-xl font-semibold mb-2">í™œë ¥ì§•í›„ (ì—¬ëŸ¬ íšŒ ì¸¡ì • ê°€ëŠ¥)</h2>
    <div id="vitalSignsContainer"></div>
    <button type="button" onclick="addVitalSigns()" class="bg-green-600 text-white px-3 py-1 rounded">+ í™œë ¥ì§•í›„ ì¶”ê°€</button>
  </div>

  <!-- GCS -->
  <div class="section">
    <h2 class="text-xl font-semibold">Glasgow Coma Scale (GCS)</h2>
    <label>ëˆˆ ë°˜ì‘ (E)</label>
    <select id="eye">
      <option value="4">ìë°œì ìœ¼ë¡œ ì—´ë¦¼</option>
      <option value="3">ì†Œë¦¬ ìê·¹ì— ì—´ë¦¼</option>
      <option value="2">í†µì¦ ìê·¹ì— ì—´ë¦¼</option>
      <option value="1">ì „í˜€ ì—´ë¦¼ ì•ˆí•¨</option>
    </select>
    <label>ì–¸ì–´ ë°˜ì‘ (V)</label>
    <select id="verbal">
      <option value="5">ì •í™•í•œ ëŒ€ë‹µ</option>
      <option value="4">í˜¼ì¡í•œ ëŒ€ë‹µ</option>
      <option value="3">í˜¼ë¯¸í•œ ëŒ€ë‹µ</option>
      <option value="2">ëª¨í˜¸í•œ ëŒ€ë‹µ</option>
      <option value="1">ì‘ë‹µ ì—†ìŒ</option>
    </select>
    <label>ìš´ë™ ë°˜ì‘ (M)</label>
    <select id="motor">
      <option value="6">ëª…ë ¹ ìˆ˜í–‰</option>
      <option value="5">í†µì¦ ìê·¹ì— êµ­ì†Œí™”</option>
      <option value="4">í†µì¦ ìê·¹ì— êµ´ê³¡</option>
      <option value="3">í†µì¦ ìê·¹ì— êµ¬ë¶€ë¦¬ê¸°</option>
      <option value="2">ê²½ë ¨</option>
      <option value="1">ìš´ë™ ì—†ìŒ</option>
    </select>
    <div id="gcsResultContainer" style="margin-top:10px; display:none;">
      <strong>GCS ê²°ê³¼:</strong> <span id="gcsResult"></span>
    </div>
  </div>

  <!-- ì‘ê¸‰ì²˜ì¹˜ -->
  <div class="section">
    <h2 class="text-xl font-semibold mb-2">ì‘ê¸‰ì²˜ì¹˜</h2>
    <textarea name="ì‘ê¸‰ì²˜ì¹˜" rows="4" placeholder="ì‹¤ì‹œí•œ ì‘ê¸‰ì²˜ì¹˜ ê¸°ë¡" class="w-full rounded-lg"></textarea>
  </div>

  <!-- ìƒí™© ì •ë³´ -->
  <div class="section">
    <h2 class="text-xl font-semibold mb-2">ìƒí™© ì •ë³´</h2>
    <label>ë°œìƒ ì‹œê°„: <input type="datetime-local" name="ë°œìƒì‹œê°„" required class="rounded-lg"></label><br>
    <label>ì¥ì†Œ: <input type="text" name="ì¥ì†Œ" placeholder="ì˜ˆ: OOë™ 123-45" required class="rounded-lg"></label><br>
    <label>ì£¼ ì¦ìƒ: <input type="text" name="ì£¼ì¦ìƒ" placeholder="ì˜ˆ: í˜¸í¡ê³¤ë€, ê°€ìŠ´ í†µì¦" required class="rounded-lg"></label>
  </div>

  <!-- ê¸°ë¡ì -->
  <div class="section">
    <h2 class="text-xl font-semibold">ê¸°ë¡ì</h2>
    <input type="text" name="ê¸°ë¡ì" placeholder="ì‘ê¸‰êµ¬ì¡°ì‚¬ ì„±ëª…" required class="rounded-lg">
  </div>

  <button type="submit" class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg">ê¸°ë¡ ì €ì¥í•˜ê¸°</button>
  <button type="button" onclick="shareReport()" class="w-full bg-purple-500 text-white py-3 px-4 rounded-lg mt-2">ê³µìœ </button>
  <div id="resultMessage" class="mt-4 text-center"></div>
</form>

<!-- ì €ì¥ëœ ë°ì´í„° -->
<div class="section">
  <h2 class="text-xl font-semibold">ì €ì¥ëœ ê¸°ë¡</h2>
  <div id="savedData" class="board"></div>
</div>

<!-- ê³µì§€ -->
<div class="discord-link">
  <p>Ver.0.9.26. E-mail: paramedic@knps.or.kr</p>
  <a href="https://discord.gg/ryaMRTAhwP" target="_blank">ë¬¸ì˜: ğŸ¸ êµ­ë¦½ê³µì› ì‘ê¸‰ì²˜ì¹˜ ì—°êµ¬íšŒ</a>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxeJXcCLpMtq8JMZAtI4KuKu0ZlZsXD6in5QeBQwl1TVMrbIewD3hv2s4d8qfR4VBogwg/exec";

// ì´ˆê¸° í™œë ¥ì§•í›„ ì¶”ê°€
function addVitalSigns() {
  const container = document.getElementById("vitalSignsContainer");
  const index = container.children.length + 1;
  const div = document.createElement("div");
  div.className = "vitalsRow";
  div.innerHTML = `
    <strong>${index}íšŒì°¨ ì¸¡ì •</strong><br>
    í˜ˆì••: <input type="text" name="í˜ˆì••[]" placeholder="120/80"><br>
    ë§¥ë°•: <input type="number" name="ë§¥ë°•[]" placeholder="íšŒ/ë¶„"><br>
    í˜¸í¡ìˆ˜: <input type="number" name="í˜¸í¡ìˆ˜[]" placeholder="íšŒ/ë¶„"><br>
    ì²´ì˜¨: <input type="number" step="0.1" name="ì²´ì˜¨[]" placeholder="â„ƒ"><br>
    SpOâ‚‚: <input type="number" name="ì‚°ì†Œí¬í™”ë„[]" placeholder="%"><br>
  `;
  container.appendChild(div);
}
addVitalSigns(); // ì²« ë²ˆì§¸ ìë™ ìƒì„±

// GCS ê³„ì‚°
function calculateGCS() {
  const eye = parseInt(document.getElementById("eye").value);
  const verbal = parseInt(document.getElementById("verbal").value);
  const motor = parseInt(document.getElementById("motor").value);
  const total = eye + verbal + motor;
  let state = '';
  if(total === 15) state='ì •ìƒ';
  else if(total >=13) state='ì¡¸ë¦¼';
  else if(total >=9) state='í˜¼ë¯¸';
  else if(total >=4) state='ë°˜í˜¼ìˆ˜';
  else state='í˜¼ìˆ˜';
  document.getElementById("gcsResult").innerText = `${total}ì  (${state})`;
  document.getElementById("gcsResultContainer").style.display="block";
}
["eye","verbal","motor"].forEach(id=>document.getElementById(id).addEventListener("change",calculateGCS));
calculateGCS();

// í¼ ì œì¶œ
document.getElementById("recordForm").addEventListener("submit", function(e){
  e.preventDefault();
  saveReport();
});

function saveReport(){
  const form = document.getElementById("recordForm");
  const formData = new FormData(form);
  const data = {};
  for(const [key,value] of formData.entries()){
    if(key.endsWith("[]")){
      const baseKey = key.replace("[]","");
      if(!data[baseKey]) data[baseKey]=[];
      data[baseKey].push(value);
    } else {
      data[key] = value;
    }
  }
  data["GCS"] = document.getElementById("gcsResult").innerText;

  // Google Sheets ì „ì†¡
  fetch(SCRIPT_URL,{
    method:"POST",
    body: JSON.stringify(data),
    headers: {"Content-Type":"application/json"}
  }).then(res=>res.text())
    .then(res=> document.getElementById("resultMessage").innerText="ì‹œíŠ¸ ì €ì¥ ì™„ë£Œ âœ…");

  // TXT ë‹¤ìš´ë¡œë“œ
  let content = "";
  for(const key in data){
    if(Array.isArray(data[key])){
      content+=`${key}: ${data[key].join(", ")}\n`;
    } else {
      content+=`${key}: ${data[key]}\n`;
    }
  }
  const today = new Date().toISOString().slice(0,10);
  const blob = new Blob([content],{type:"text/plain"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href=url;
  a.download=`í™˜ìí‰ê°€_${today}.txt`;
  a.click();
  URL.revokeObjectURL(url);

  document.getElementById("savedData").innerHTML = `<div class="board-item">${content}</div>`;
}

// ê³µìœ  ê¸°ëŠ¥
function shareReport(){
  const form = document.getElementById("recordForm");
  const formData = new FormData(form);
  let text = "";
  formData.forEach((value,key)=>{ text+=`${key}: ${value}\n`; });
  text += "GCS: "+document.getElementById("gcsResult").innerText;
  if(navigator.share){
    navigator.share({title:"í™˜ì í‰ê°€ ê¸°ë¡", text});
  } else {
    alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ê³µìœ  ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
  }
}
</script>

</body>
</html>


