<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ğŸ†˜ QR êµ¬ì¡°ìš”ì²­ GPS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ì¹´ì¹´ì˜¤ ì§€ë„ API -->
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_KAKAO_APP_KEY"></script>

<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; }
header {
    background:#c62828; color:white;
    padding:12px; text-align:center;
    font-size:20px;
}
#map { width:100%; height:300px; }
section { padding:15px; }
input, textarea, button {
    width:100%; padding:10px;
    margin-top:8px; font-size:16px;
}
button {
    background:#d32f2f; color:white;
    border:none; cursor:pointer;
}
button.secondary {
    background:#1976d2;
}
.info {
    background:#f5f5f5;
    padding:10px; margin-top:10px;
}
</style>
</head>
<body>

<header>ğŸ†˜ QR êµ¬ì¡°ìš”ì²­ ìœ„ì¹˜ ê³µìœ </header>

<div id="map"></div>

<section>
    <div class="info" id="gpsInfo">ìœ„ì¹˜ í™•ì¸ ì¤‘...</div>

    <h3>ğŸ‘¤ í™˜ì ì •ë³´</h3>
    <input id="name" placeholder="í™˜ì ì´ë¦„">
    <input id="age" placeholder="ë‚˜ì´ / ì„±ë³„">
    <textarea id="condition" placeholder="ì¦ìƒ ë° ìƒí™© (ì˜ˆ: ì¶”ë½ í›„ ì˜ì‹ì €í•˜)"></textarea>

    <button onclick="sendRescue()">ğŸš¨ êµ¬ì¡° ìš”ì²­</button>
</section>

<script>
let map, marker;
let lat = 0, lng = 0;

// ì§€ë„ ì´ˆê¸°í™”
function initMap() {
    map = new kakao.maps.Map(document.getElementById('map'), {
        center: new kakao.maps.LatLng(37.5665, 126.9780),
        level: 3
    });
    marker = new kakao.maps.Marker({ map: map });
}
initMap();

// ì‹¤ì‹œê°„ ìœ„ì¹˜ ê°±ì‹ 
navigator.geolocation.watchPosition(pos => {
    lat = pos.coords.latitude;
    lng = pos.coords.longitude;

    const loc = new kakao.maps.LatLng(lat, lng);
    map.setCenter(loc);
    marker.setPosition(loc);

    document.getElementById("gpsInfo").innerHTML = `
        ğŸ“ ìœ„ë„: ${lat.toFixed(6)}<br>
        ğŸ“ ê²½ë„: ${lng.toFixed(6)}
    `;
}, () => {
    alert("ìœ„ì¹˜ ê¶Œí•œ í•„ìš”");
}, {
    enableHighAccuracy: true,
    maximumAge: 0,
    timeout: 5000
});

// êµ¬ì¡°ìš”ì²­
function sendRescue() {
    const data = {
        lat, lng,
        name: document.getElementById("name").value,
        age: document.getElementById("age").value,
        condition: document.getElementById("condition").value
    };

    const url = location.origin + location.pathname +
        `?mode=rescue&data=${encodeURIComponent(JSON.stringify(data))}`;

    alert("êµ¬ì¡° ìš”ì²­ ë§í¬ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.\nêµ¬ì¡°ëŒ€ì— ì „ë‹¬í•˜ì„¸ìš”.");
    window.open(url, "_blank");
}

// êµ¬ì¡°ëŒ€ ì „ìš© í™”ë©´
const params = new URLSearchParams(location.search);
if (params.get("mode") === "rescue") {
    const data = JSON.parse(decodeURIComponent(params.get("data")));

    document.body.innerHTML = `
        <header>ğŸš‘ êµ¬ì¡°ëŒ€ ì „ìš© í™”ë©´</header>
        <div id="map" style="height:300px"></div>
        <section class="info">
            <b>í™˜ì:</b> ${data.name}<br>
            <b>ë‚˜ì´/ì„±ë³„:</b> ${data.age}<br>
            <b>ì¦ìƒ:</b> ${data.condition}<br>
            <b>ìœ„ì¹˜:</b> ${data.lat}, ${data.lng}<br><br>
            <a href="https://map.kakao.com/link/map/${data.lat},${data.lng}" target="_blank">
                ğŸ—ºï¸ ì¹´ì¹´ì˜¤ì§€ë„ ì—´ê¸°
            </a>
        </section>
    `;

    setTimeout(() => {
        const map2 = new kakao.maps.Map(document.getElementById('map'), {
            center: new kakao.maps.LatLng(data.lat, data.lng),
            level: 3
        });
        new kakao.maps.Marker({
            position: new kakao.maps.LatLng(data.lat, data.lng),
            map: map2
        });
    }, 300);
}
</script>

</body>
</html>
