<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ğŸ†˜ ë¬´ë“±ì‚°êµ­ë¦½ê³µì› êµ¬ì¡°ìš”ì²­</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ì¹´ì¹´ì˜¤ ì§€ë„ API -->
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=ff9e145029506d6e4c72d1f2b01ea424&libraries=services"></script>

<style>
body {
    margin:0;
    font-family: Arial, sans-serif;
    background:#f5f5f5;
}
header {
    background:#b71c1c;
    color:white;
    padding:14px;
    text-align:center;
    font-size:20px;
}
#map {
    width:100%;
    height:300px;
}
section {
    padding:15px;
}
.info {
    background:white;
    padding:12px;
    border-radius:6px;
    margin-bottom:10px;
}
textarea, button {
    width:100%;
    padding:10px;
    margin-top:8px;
    font-size:16px;
}
textarea { resize:vertical; }
button {
    background:#d32f2f;
    color:white;
    border:none;
    border-radius:6px;
    cursor:pointer;
    font-size:18px;
}
.small {
    font-size:14px;
    color:#555;
}
</style>
</head>
<body>

<header>ğŸ†˜ ë¬´ë“±ì‚°êµ­ë¦½ê³µì› êµ¬ì¡°ìš”ì²­</header>

<div id="map"></div>

<section>
    <div class="info" id="gpsInfo">ğŸ“ ìœ„ì¹˜ í™•ì¸ ì¤‘...</div>

    <div class="info">
        <b>ğŸ‘¤ êµ¬ì¡°ìš”ì²­</b>
        <textarea id="condition" placeholder="ì¦ìƒ ë° ìƒí™© (ì˜ˆ: ë‚´ìœ„ì¹˜ ë“±)"></textarea>
    </div>

    <button onclick="sendSMS()">âœ‰ï¸ ë¬¸ì ì „ì†¡</button>
    <button onclick="callRescue()" style="margin-top:5px;">ğŸ“ ì „í™” ì—°ê²°</button>

    <div class="small">
        â€» ë¬¸ì ë° ì „í™”ëŠ” <b>ë¬´ë“±ì‚°íŠ¹ìˆ˜ì‚°ì•…êµ¬ì¡°ëŒ€</b>ë¡œ ì—°ê²°ë©ë‹ˆë‹¤
    </div>
</section>

<script>
let map, marker;
let lat = null, lng = null;

// êµ¬ì¡°ëŒ€ ë²ˆí˜¸
const RESCUE_NUMBER = "01066650113";

// êµ¬ê¸€ì‹œíŠ¸ Apps Script ì›¹ì•± URL
const GOOGLE_SHEET_API = "https://script.google.com/macros/s/AKfycbyTOMmbvCIDZ5VpxWQS5hdjdXdwcvoYsva-Ljtd2Y81lBfuSsPJ-jYhdMPhhxz31jHCaQ/exec";

// ì§€ë„ ì´ˆê¸°í™”
function initMap(latInit = 37.5665, lngInit = 126.9780) {
    map = new kakao.maps.Map(document.getElementById("map"), {
        center: new kakao.maps.LatLng(latInit, lngInit),
        level: 3
    });
    marker = new kakao.maps.Marker({ map: map });
}
initMap();

// ì‹¤ì‹œê°„ GPS
if (navigator.geolocation) {
    navigator.geolocation.watchPosition(
        pos => {
            lat = pos.coords.latitude;
            lng = pos.coords.longitude;

            const loc = new kakao.maps.LatLng(lat, lng);
            map.setCenter(loc);
            marker.setPosition(loc);

            document.getElementById("gpsInfo").innerHTML = `
                ğŸ“ ìœ„ë„: ${lat.toFixed(6)}<br>
                ğŸ“ ê²½ë„: ${lng.toFixed(6)}
            `;
        },
        err => alert("ìœ„ì¹˜ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤."),
        { enableHighAccuracy:true, maximumAge:0, timeout:5000 }
    );
} else {
    alert("ì´ ë¸Œë¼ìš°ì €ëŠ” GPSë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
}

// ë¬¸ì ì „ì†¡ + êµ¬ê¸€ì‹œíŠ¸ ì €ì¥
function sendSMS() {
    if (lat === null || lng === null) {
        alert("ìœ„ì¹˜ í™•ì¸ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.");
        return;
    }

    const condition = document.getElementById("condition").value || "-";
    const payload = {
        lat: lat.toFixed(6),
        lng: lng.toFixed(6),
        condition
    };

    // êµ¬ê¸€ì‹œíŠ¸ ì €ì¥
    fetch(GOOGLE_SHEET_API, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
    }).catch(err => console.error("ì‹œíŠ¸ ì €ì¥ ì‹¤íŒ¨", err));

    const message = `[êµ¬ì¡°ìš”ì²­]\nìœ„ë„: ${payload.lat}\nê²½ë„: ${payload.lng}\nì¦ìƒ: ${condition}`;
    location.href = `sms:${RESCUE_NUMBER}?body=${encodeURIComponent(message)}`;
}

// ì „í™” ì—°ê²°
function callRescue() {
    location.href = `tel:${RESCUE_NUMBER}`;
}
</script>

</body>
</html>
