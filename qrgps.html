<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ğŸ†˜ ì‚°ì•…ì‚¬ê³  êµ¬ì¡°ìš”ì²­</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=ff9e145029506d6e4c72d1f2b01ea424&libraries=services"></script>
<style>
body { margin:0; font-family: Arial, sans-serif; background:#f5f5f5; }
header { background:#b71c1c; color:white; padding:14px; text-align:center; font-size:20px; }
#map { width:100%; height:450px; }
section { padding:15px; padding-bottom:30px; }
textarea, button { width:90%; padding:10px; margin-top:8px; font-size:16px; }
textarea { resize:vertical; }
button { background:#d32f2f; color:white; border:none; border-radius:6px; cursor:pointer; font-size:18px; }
.info { background:white; padding:12px; border-radius:6px; margin-bottom:10px; }
.small { font-size:13px; color:#555; }
.consent {
  font-size:13px;
  color:#333;
  background:#fff3f3;
  border-left:4px solid #d32f2f;
  padding:10px;
  margin:10px;
}
</style>
</head>
<body>

<header>ğŸ†˜ ë¬´ë“±ì‚° ì‚°ì•…êµ¬ì¡° ìš”ì²­</header>
<div class="consent">
<b>ğŸ“ ìœ„ì¹˜ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ì•ˆë‚´</b><br>
  ë³¸ ì„œë¹„ìŠ¤ëŠ” êµ¬ì¡° ìš”ì²­ ì‹œ <b>GPS ìœ„ì¹˜ì •ë³´ì™€ ìš”ì²­ ì‹œê°</b>ì„ ìˆ˜ì§‘í•˜ë©°,
ì´ ì •ë³´ëŠ” êµ¬ì¡°Â·êµ¬ê¸‰ ëª©ì ì—ë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤.<br>
<b>[ë¬¸ì ì „ì†¡ ë²„íŠ¼]</b>ì„ ëˆ„ë¥´ë©´ ìœ„ì¹˜ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ë™ì˜í•œ ê²ƒìœ¼ë¡œ ê°„ì£¼ë©ë‹ˆë‹¤.
</div>
  
<section>
  <div class="info" id="gpsInfo">ğŸ“ í˜„ì¬ ìœ„ì¹˜ í™•ì¸ ì¤‘...</div>
  <button onclick="sendSMSAndCall()">âœ‰ï¸ ì‚°ì•…êµ¬ì¡°ëŒ€ ë¬¸ìì „ì†¡</button>

  <br><br>
<div class="small">
        â€» ë¬¸ìì „ì†¡ì€ <b>ë¬´ë“±ì‚° íŠ¹ìˆ˜ì‚°ì•…êµ¬ì¡°ëŒ€</b>ë¡œ ì—°ê²°ë©ë‹ˆë‹¤
  </div>

  <br> 

</section>

<div id="map"></div>

<script>
let map, userMarker;
let currentLat = null, currentLng = null;
let markers = [];
const RESCUE_NUMBER = "01066650113";
const GOOGLE_SHEET_API = "https://script.google.com/macros/s/AKfycbyTOMmbvCIDZ5VpxWQS5hdjdXdwcvoYsva-Ljtd2Y81lBfuSsPJ-jYhdMPhhxz31jHCaQ/exec";

function initMap(latInit = 35.162321, lngInit = 126.980342) {
  map = new kakao.maps.Map(document.getElementById("map"), {
    center: new kakao.maps.LatLng(latInit, lngInit),
    level: 3
  });
  userMarker = new kakao.maps.Marker({ map });
}
initMap();

// GPS ì¶”ì 
navigator.geolocation.watchPosition(
  pos => {
    currentLat = pos.coords.latitude;
    currentLng = pos.coords.longitude;
    const loc = new kakao.maps.LatLng(currentLat, currentLng);
    map.setCenter(loc);
    userMarker.setPosition(loc);
    document.getElementById("gpsInfo").innerHTML =
      `ğŸ“ í˜„ì¬ ìœ„ì¹˜<br>ìœ„ë„: ${currentLat.toFixed(6)}<br>ê²½ë„: ${currentLng.toFixed(6)}`;
  },
  () => {
    document.getElementById("gpsInfo").innerText =
      "ğŸ“ ìœ„ì¹˜ í™•ì¸ ì‹¤íŒ¨: ìœ„ì¹˜ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.";
  },
  { enableHighAccuracy:true }
);

// âœ… êµ¬ì¡°ìš”ì²­ = ë™ì˜ ê°„ì£¼
function sendSMSAndCall() {
  if (!currentLat || !currentLng) {
    alert("ìœ„ì¹˜ í™•ì¸ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.");
    return;
  }

  const now = new Date().toISOString();
  const lat = currentLat.toFixed(6);
  const lng = currentLng.toFixed(6);
  const kakaoMapLink = `http://map.kakao.com/link/map/${lat},${lng}`;

  // âœ… ìµëª… ë™ì˜ í¬í•¨ payload (GPSë§Œ)
  const payload = {
    lat: parseFloat(lat),
    lng: parseFloat(lng),
    agreed_at: now,
    consent_type: "êµ¬ì¡°ìš”ì²­ ë²„íŠ¼ í´ë¦­"
  };

  fetch(GOOGLE_SHEET_API, {
    method: "POST",
    body: JSON.stringify(payload)
  });

  // ë¬¸ì ì „ì†¡
  location.href = `sms:${RESCUE_NUMBER}?body=${encodeURIComponent(
`ğŸš¨ [ì‚°ì•…êµ¬ì¡°ìš”ì²­]

ğŸ“ ìœ„ë„: ${lat}
ğŸ“ ê²½ë„: ${lng}
ğŸ—º ${kakaoMapLink}

â˜ï¸ í†µí™” ì‹œ ìœ„ë„Â·ê²½ë„ë¥¼ ê·¸ëŒ€ë¡œ ì „ë‹¬í•´ì£¼ì„¸ìš”.`
  )}`;
}
</script>

</body>
</html>
