<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ğŸ†˜ êµ¬ì¡°ìš”ì²­</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ì¹´ì¹´ì˜¤ ì§€ë„ API -->
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=ff9e145029506d6e4c72d1f2b01ea424&libraries=services"></script>

<style>
body { margin:0; font-family: Arial, sans-serif; background:#f5f5f5; }
header {
    background:#b71c1c;
    color:white;
    padding:14px;
    text-align:center;
    font-size:20px;
}
#map { width:100%; height:300px; }
section { padding:15px; }
.info {
    background:white;
    padding:12px;
    border-radius:6px;
    margin-bottom:10px;
}
input, textarea, button {
    width:100%;
    padding:10px;
    margin-top:8px;
    font-size:16px;
}
textarea { resize:vertical; }
button {
    background:#d32f2f;
    color:white;
    border:none;
    border-radius:6px;
    cursor:pointer;
}
.call {
    background:#2e7d32;
    margin-top:10px;
}
.small {
    font-size:14px;
    color:#555;
}
</style>
</head>
<body>

<header>ğŸ†˜ êµ¬ì¡°ìš”ì²­</header>
<div id="map"></div>

<section id="userScreen">
    <div class="info" id="gpsInfo">ğŸ“ ìœ„ì¹˜ í™•ì¸ ì¤‘...</div>

    <div class="info">
        <b>ğŸ‘¤ í™˜ì ì •ë³´</b>
        <input id="name" placeholder="ì´ë¦„ (ë¯¸ìƒ ê°€ëŠ¥)">
        <input id="age" placeholder="ë‚˜ì´ / ì„±ë³„">
        <textarea id="condition" placeholder="ì¦ìƒ ë° ìƒí™© (ì˜ˆ: ì¶”ë½ í›„ ì˜ì‹ì €í•˜)"></textarea>
    </div>

    <button onclick="sendRescue()">ğŸš¨ êµ¬ì¡° ìš”ì²­ Â· ê³µìœ  Â· ì „í™”</button>
    <div class="small">â€» ë²„íŠ¼ í´ë¦­ ì‹œ 119ë¡œ ì „í™” ì—°ê²°ë©ë‹ˆë‹¤</div>
</section>

<script>
let map, marker;
let lat = null, lng = null;

// URL íŒŒë¼ë¯¸í„°
const params = new URLSearchParams(location.search);
const isRescueView = params.get("mode") === "rescue";

// ì§€ë„ ì´ˆê¸°í™”
function initMap(latInit = 37.5665, lngInit = 126.9780) {
    map = new kakao.maps.Map(document.getElementById("map"), {
        center: new kakao.maps.LatLng(latInit, lngInit),
        level: 3
    });
    marker = new kakao.maps.Marker({ map: map });
}

// =====================
// êµ¬ì¡°ëŒ€ ì „ìš© í™”ë©´
// =====================
if (isRescueView) {
    const data = JSON.parse(decodeURIComponent(params.get("data")));

    document.getElementById("userScreen").innerHTML = `
        <div class="info">
            <b>ğŸš‘ êµ¬ì¡°ëŒ€ ì „ìš© ì •ë³´</b><br><br>
            <b>í™˜ì:</b> ${data.name || "ë¯¸ìƒ"}<br>
            <b>ë‚˜ì´/ì„±ë³„:</b> ${data.age || "-"}<br>
            <b>ì¦ìƒ:</b> ${data.condition || "-"}<br>
            <b>ì‹œê°„:</b> ${data.time}<br>
            <b>ì¢Œí‘œ:</b> ${data.lat}, ${data.lng}<br><br>
            <a href="https://map.kakao.com/link/map/${data.lat},${data.lng}" target="_blank">
                ğŸ—ºï¸ ì¹´ì¹´ì˜¤ì§€ë„ì—ì„œ ì—´ê¸°
            </a>
        </div>
    `;

    initMap(data.lat, data.lng);
    marker.setPosition(new kakao.maps.LatLng(data.lat, data.lng));

} else {

    // =====================
    // êµ¬ì¡° ëŒ€ìƒì í™”ë©´
    // =====================
    initMap();

    navigator.geolocation.watchPosition(pos => {
        lat = pos.coords.latitude;
        lng = pos.coords.longitude;

        const loc = new kakao.maps.LatLng(lat, lng);
        map.setCenter(loc);
        marker.setPosition(loc);

        document.getElementById("gpsInfo").innerHTML = `
            ğŸ“ ìœ„ë„: ${lat.toFixed(6)}<br>
            ğŸ“ ê²½ë„: ${lng.toFixed(6)}
        `;
    }, () => {
        alert("ìœ„ì¹˜ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.");
    }, {
        enableHighAccuracy: true,
        maximumAge: 0,
        timeout: 5000
    });
}

// ===========ì› ì „í™”
// =====================
function sendRescue() {
    if (lat === null || lng === null) {
        alert("ìœ„ì¹˜ í™•ì¸ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.");
        return;
    }

    const data = {
        lat, lng,
        name: document.getElementById("name").value,
        age: document.getElementById("age").value,
        condition: document.getElementById("condition").value,
        time: new Date().toLocaleString()
    };

    const rescueUrl =
        location.origin + location.pathname +
        `?mode=rescue&data=${encodeURIComponent(JSON.stringify(data))}`;

    // 1ï¸âƒ£ êµ¬ì¡°ìš”ì²­ í˜ì´ì§€ ê³µìœ 
    if (navigator.share) {
        navigator.share({
            title: "ğŸ†˜ êµ¬ì¡° ìš”ì²­",
            text: "í˜„ì¬ ìœ„ì¹˜ ë° í™˜ì ì •ë³´ì…ë‹ˆë‹¤.",
            url: rescueUrl
        });
    } else {
        navigator.clipboard.writeText(rescueUrl);
    }

    // 2ï¸âƒ£ êµ¬ì¡° ì „í™” ì—°ê²°
    setTimeout(() => {
        location.href = "tel:010-3190-1187";
    }, 800);
}
</script>

}, 800);
}
</scri
