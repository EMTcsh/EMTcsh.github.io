<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>실시간 출동 모니터링</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f4f4f4; }
    .alert { background-color: #ff4c4c; color: white; font-weight: bold; animation: blink 1s infinite; }
    @keyframes blink { 0%, 50%, 100% { opacity: 1; } 25%, 75% { opacity: 0; } }
  </style>
</head>
<body>
  <h2>오늘 출동 데이터 모니터</h2>
  <table id="dataTable">
    <thead>
      <tr id="tableHeader"></tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

  <script>
    // 데이터 가져오기 및 테이블 갱신
    async function fetchData() {
      google.script.run.withSuccessHandler(renderTable).getTodayData();
    }

    function renderTable(data) {
      const headerRow = document.getElementById("tableHeader");
      const body = document.getElementById("tableBody");

      // 헤더
      headerRow.innerHTML = "";
      if (!data || data.length === 0) {
        body.innerHTML = "<tr><td colspan='10'>오늘 데이터가 없습니다.</td></tr>";
        return;
      }

      const headers = Object.keys(data[0]);
      headers.forEach(h => {
        const th = document.createElement("th");
        th.textContent = h;
        headerRow.appendChild(th);
      });

      // 본문
      body.innerHTML = "";
      data.forEach(row => {
        const tr = document.createElement("tr");
        headers.forEach(h => {
          const td = document.createElement("td");
          td.textContent = row[h];

          // GCS 기준 경고 표시
          if (h === "GCS" && parseInt(row[h], 10) <= 8) {
            td.classList.add("alert");
          }
          tr.appendChild(td);
        });
        body.appendChild(tr);
      });
    }

    // 5초마다 갱신
    setInterval(fetchData, 5000);
    fetchData();
  </script>
</body>
</html>
