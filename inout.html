<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>êµ­ë¦½ê³µì› ì•ˆì „ì‚°í–‰ ì²´í¬</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial;background:#f4f6f8;padding:20px}
.container{max-width:500px;margin:auto;background:#fff;padding:20px;border-radius:10px}
button{width:100%;padding:15px;font-size:16px;margin-top:10px;border:none;border-radius:6px;color:#fff}
.entry{background:#4caf50}
.mid{background:#2196f3}
.exit{background:#f44336}
input{width:100%;padding:12px;margin-bottom:10px}
#result{margin-top:15px;background:#f1f1f1;padding:10px;border-radius:6px}
</style>
</head>

<body>
<div class="container">
  <h2>êµ­ë¦½ê³µì› ì•ˆì „ì‚°í–‰ ì²´í¬</h2>

  <input type="tel" id="phone" placeholder="íœ´ëŒ€í° ë²ˆí˜¸">

  <button class="entry" onclick="scan('ì…ì¥')">ì…êµ¬ ìŠ¤ìº”</button>
  <button class="mid" onclick="scan('ì¤‘ê°„')">ì¤‘ê°„ ìŠ¤ìº”</button>
  <button class="exit" onclick="scan('í‡´ì¥')">ì¶œêµ¬ ìŠ¤ìº”</button>

  <div id="result">ëŒ€ê¸° ì¤‘...</div>
</div>

<script>
const SHEET_URL =
  "https://script.google.com/macros/s/AKfycbzS7f9kvdKyWM82TG0dL-fmzM1psiprI2JJD1MHEhY7HBgjD0k07Xv9bJZagGBZuR6Q/exec";

if(localStorage.phone){
  document.getElementById('phone').value = localStorage.phone;
}

function scan(stage){
  const phone = document.getElementById('phone').value.trim();
  if(!phone){ alert('íœ´ëŒ€í° ë²ˆí˜¸ ì…ë ¥'); return; }
  localStorage.phone = phone;

  navigator.geolocation.getCurrentPosition(pos=>{
    const lat  = pos.coords.latitude.toFixed(6);
    const lng  = pos.coords.longitude.toFixed(6);
    const time = new Date().toLocaleString();

    document.getElementById('result').innerHTML =
      `ğŸ“¡ ìœ„ì¹˜ í™•ì¸ë¨<br>ì „ì†¡ ì¤‘...`;

    fetch(SHEET_URL,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({ stage, phone, lat, lng, time })
    })
    .then(res => res.text())
    .then(text => {
      console.log(text);
      const data = JSON.parse(text);
      if(data.result === 'OK'){
        document.getElementById('result').innerHTML =
          `âœ… ${stage} ì™„ë£Œ<br>êµ¬ê¸€ì‹œíŠ¸ ì €ì¥ë¨`;
      } else {
        throw new Error(data.error);
      }
    })
    .catch(err=>{
      document.getElementById('result').innerText =
        'âŒ ì „ì†¡ ì‹¤íŒ¨: ' + err.message;
    });
  });
}
</script>
</body>
</html>
