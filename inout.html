<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>êµ­ë¦½ê³µì› ì•ˆì „ì‚°í–‰ ì²´í¬</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial;background:#f4f6f8;padding:20px}
.container{max-width:500px;margin:auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,0.1)}
h2{text-align:center}
button{width:100%;padding:15px;font-size:16px;margin-top:10px;border:none;border-radius:6px;color:#fff}
.entry{background:#4caf50}
.mid{background:#2196f3}
.exit{background:#f44336}
input{width:100%;padding:12px;font-size:15px;margin-bottom:10px}
#result{margin-top:15px;font-size:14px;background:#f1f1f1;padding:10px;border-radius:6px}
</style>
</head>

<body>
<div class="container">
  <h2>ğŸï¸ êµ­ë¦½ê³µì› ì•ˆì „ì‚°í–‰ ì²´í¬</h2>

  <input type="tel" id="phone" placeholder="íœ´ëŒ€í° ë²ˆí˜¸ (ìµœì´ˆ 1íšŒ ì…ë ¥)">

  <button class="entry" onclick="scan('ì…ì¥')">ì…êµ¬ ìŠ¤ìº”</button>
  <button class="mid" onclick="scan('ì¤‘ê°„')">ì¤‘ê°„ ìŠ¤ìº”</button>
  <button class="exit" onclick="scan('í‡´ì¥')">ì¶œêµ¬ ìŠ¤ìº”</button>

  <div id="result">ëŒ€ê¸° ì¤‘...</div>
</div>

<script>
/* â­â­â­ ë°˜ë“œì‹œ ì…ë ¥ â­â­â­ */
const SHEET_URL = "https://script.google.com/macros/s/AKfycbzS7f9kvdKyWM82TG0dL-fmzM1psiprI2JJD1MHEhY7HBgjD0k07Xv9bJZagGBZuR6Q/exec";

/* ì „í™”ë²ˆí˜¸ ê¸°ì–µ */
if(localStorage.phone){
  document.getElementById('phone').value = localStorage.phone;
}

function scan(stage){
  const phone = document.getElementById('phone').value.trim();
  if(!phone){
    alert('íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
    return;
  }
  localStorage.phone = phone;

  if(!navigator.geolocation){
    alert('GPSë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ê¸°ê¸°ì…ë‹ˆë‹¤');
    return;
  }

  document.getElementById('result').innerText = 'ğŸ“¡ ìœ„ì¹˜ í™•ì¸ ì¤‘...';

  navigator.geolocation.getCurrentPosition(pos=>{
    const lat  = pos.coords.latitude.toFixed(6);
    const lng  = pos.coords.longitude.toFixed(6);
    const time = new Date().toLocaleString();

    document.getElementById('result').innerHTML =
      `ğŸ“ ${stage} ì¢Œí‘œ í™•ì¸<br>
       ìœ„ë„: ${lat}<br>
       ê²½ë„: ${lng}<br>
       ì „ì†¡ ì¤‘...`;

    fetch(SHEET_URL,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({ stage, phone, lat, lng, time })
    })
    .then(res => res.json())
    .then(data => {
      if(data.result === 'OK'){
        document.getElementById('result').innerHTML =
          `âœ… ${stage} ì™„ë£Œ<br><b>êµ¬ê¸€ì‹œíŠ¸ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤</b>`;
      } else {
        throw new Error(data.error);
      }
    })
    .catch(err => {
      document.getElementById('result').innerText =
        'âŒ ì „ì†¡ ì‹¤íŒ¨: ' + err.message;
    });

  }, ()=>{
    alert('ìœ„ì¹˜ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤');
  });
}
</script>
</body>
</html>

